var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,e){a!=Array.prototype&&a!=Object.prototype&&(a[c]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var e=0,b={next:function(){if(e<a.length){var f=e++;return{value:c(f,a[f]),done:!1}}b.next=function(){return{done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};
$jscomp.polyfill=function(a,c,e,b){if(c){e=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var f=a[b];f in e||(e[f]={});e=e[f]}a=a[a.length-1];b=e[a];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.checkStringArgs=function(a,c,e){if(null==a)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var b="";a;)if(a&1&&(b+=c),a>>>=1)c+=c;return b}},"es6-impl","es3");var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};
dat.utils.css=function(){return{load:function(a,c){c=c||document;var e=c.createElement("link");e.type="text/css";e.rel="stylesheet";e.href=a;c.getElementsByTagName("head")[0].appendChild(e)},inject:function(a,c){c=c||document;var e=document.createElement("style");e.type="text/css";e.innerHTML=a;c.getElementsByTagName("head")[0].appendChild(e)}}}();
dat.utils.common=function(){var a=Array.prototype.forEach,c=Array.prototype.slice;return{BREAK:{},extend:function(a){this.each(c.call(arguments,1),function(b){for(var c in b)this.isUndefined(b[c])||(a[c]=b[c])},this);return a},defaults:function(a){this.each(c.call(arguments,1),function(b){for(var c in b)this.isUndefined(a[c])&&(a[c]=b[c])},this);return a},compose:function(){var a=c.call(arguments);return function(){for(var b=c.call(arguments),f=a.length-1;0<=f;f--)b=[a[f].apply(this,b)];return b[0]}},
each:function(c,b,f){if(a&&c.forEach===a)c.forEach(b,f);else if(c.length===c.length+0)for(var d=0,e=c.length;d<e&&!(d in c&&b.call(f,c[d],d)===this.BREAK);d++);else for(d in c)if(b.call(f,c[d],d)===this.BREAK)break},defer:function(a){setTimeout(a,0)},toArray:function(a){return a.toArray?a.toArray():c.call(a)},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isNaN:function(a){return a!==a},isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(a){return a===
Object(a)},isNumber:function(a){return a===a+0},isString:function(a){return a===a+""},isBoolean:function(a){return!1===a||!0===a},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)}}}();
dat.controllers.Controller=function(a){var c=function(a,c){this.initialValue=a[c];this.domElement=document.createElement("div");this.object=a;this.property=c;this.__onFinishChange=this.__onChange=void 0};a.extend(c.prototype,{onChange:function(a){this.__onChange=a;return this},onFinishChange:function(a){this.__onFinishChange=a;return this},setValue:function(a){this.object[this.property]=a;this.__onChange&&this.__onChange.call(this,a);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return c}(dat.utils.common);
dat.dom.dom=function(a){function c(d){if("0"===d||a.isUndefined(d))return 0;d=d.match(b);return a.isNull(d)?0:parseFloat(d[1])}var e={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(d,c){a.each(d,function(d){e[d]=c})});var b=/(\d+(\.\d+)?)px/,f={makeSelectable:function(d,a){void 0!==d&&void 0!==d.style&&(d.onselectstart=a?function(){return!1}:function(){},d.style.MozUserSelect=a?"auto":"none",d.style.KhtmlUserSelect=
a?"auto":"none",d.unselectable=a?"on":"off")},makeFullscreen:function(d,c,b){a.isUndefined(c)&&(c=!0);a.isUndefined(b)&&(b=!0);d.style.position="absolute";c&&(d.style.left=0,d.style.right=0);b&&(d.style.top=0,d.style.bottom=0)},fakeEvent:function(d,c,b,f){b=b||{};var h=e[c];if(!h)throw Error("Event type "+c+" not supported.");var k=document.createEvent(h);switch(h){case "MouseEvents":k.initMouseEvent(c,b.bubbles||!1,b.cancelable||!0,window,b.clickCount||1,0,0,b.x||b.clientX||0,b.y||b.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":h=k.initKeyboardEvent||k.initKeyEvent;a.defaults(b,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});h(c,b.bubbles||!1,b.cancelable,window,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.keyCode,b.charCode);break;default:k.initEvent(c,b.bubbles||!1,b.cancelable||!0)}a.defaults(k,f);d.dispatchEvent(k)},bind:function(d,a,b,c){d.addEventListener?d.addEventListener(a,b,c||!1):d.attachEvent&&d.attachEvent("on"+a,b);return f},
unbind:function(d,a,b,c){d.removeEventListener?d.removeEventListener(a,b,c||!1):d.detachEvent&&d.detachEvent("on"+a,b);return f},addClass:function(d,a){if(void 0===d.className)d.className=a;else if(d.className!==a){var b=d.className.split(/ +/);-1==b.indexOf(a)&&(b.push(a),d.className=b.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return f},removeClass:function(d,a){if(a){if(void 0!==d.className)if(d.className===a)d.removeAttribute("class");else{var b=d.className.split(/ +/);a=b.indexOf(a);-1!=
a&&(b.splice(a,1),d.className=b.join(" "))}}else d.className=void 0;return f},hasClass:function(d,a){return RegExp("(?:^|\\s+)"+a+"(?:\\s+|$)").test(d.className)||!1},getWidth:function(d){d=getComputedStyle(d);return c(d["border-left-width"])+c(d["border-right-width"])+c(d["padding-left"])+c(d["padding-right"])+c(d.width)},getHeight:function(d){d=getComputedStyle(d);return c(d["border-top-width"])+c(d["border-bottom-width"])+c(d["padding-top"])+c(d["padding-bottom"])+c(d.height)},getOffset:function(d){var a=
{left:0,top:0};if(d.offsetParent){do a.left+=d.offsetLeft,a.top+=d.offsetTop;while(d=d.offsetParent)}return a},isActive:function(d){return d===document.activeElement&&(d.type||d.href)}};return f}(dat.utils.common);
dat.controllers.OptionController=function(a,c,e){var b=function(a,d,k){b.superclass.call(this,a,d);var f=this;this.__select=document.createElement("select");if(e.isArray(k)){var l={};e.each(k,function(a){l[a]=a});k=l}e.each(k,function(a,d){var b=document.createElement("option");b.innerHTML=d;b.setAttribute("value",a);f.__select.appendChild(b)});this.updateDisplay();c.bind(this.__select,"change",function(){f.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
b.superclass=a;e.extend(b.prototype,a.prototype,{setValue:function(a){a=b.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return b.superclass.prototype.updateDisplay.call(this)}});return b}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(a,c){var e=function(a,f,d){e.superclass.call(this,a,f);d=d||{};this.__min=d.min;this.__max=d.max;this.__step=d.step;a=this.__impliedStep=c.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step;a=a.toString();this.__precision=-1<a.indexOf(".")?a.length-a.indexOf(".")-1:0};e.superclass=a;c.extend(e.prototype,a.prototype,{setValue:function(a){void 0!==this.__min&&a<this.__min?a=this.__min:
void 0!==this.__max&&a>this.__max&&(a=this.__max);void 0!==this.__step&&0!=a%this.__step&&(a=Math.round(a/this.__step)*this.__step);return e.superclass.prototype.setValue.call(this,a)},min:function(a){this.__min=a;return this},max:function(a){this.__max=a;return this},step:function(a){this.__step=a;return this}});return e}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(a,c,e){var b=function(a,d,k){function f(){var a=parseFloat(p.__input.value);e.isNaN(a)||p.setValue(a)}function l(a){var d=v-a.clientY;p.setValue(p.getValue()+d*p.__impliedStep);v=a.clientY}function n(){c.unbind(window,"mousemove",l);c.unbind(window,"mouseup",n)}this.__truncationSuspended=!1;b.superclass.call(this,a,d,k);var p=this,v;this.__input=document.createElement("input");this.__input.setAttribute("type","text");c.bind(this.__input,"change",f);c.bind(this.__input,
"blur",function(){f();p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())});c.bind(this.__input,"mousedown",function(a){c.bind(window,"mousemove",l);c.bind(window,"mouseup",n);v=a.clientY});c.bind(this.__input,"keydown",function(a){13===a.keyCode&&(p.__truncationSuspended=!0,this.blur(),p.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};b.superclass=a;e.extend(b.prototype,a.prototype,{updateDisplay:function(){var a=this.__input;if(this.__truncationSuspended)var d=
this.getValue();else{d=this.getValue();var c=Math.pow(10,this.__precision);d=Math.round(d*c)/c}a.value=d;return b.superclass.prototype.updateDisplay.call(this)}});return b}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(a,c,e,b,f){var d=function(a,b,f,e,p){function h(a){a.preventDefault();var d=c.getOffset(g.__background),b=c.getWidth(g.__background);g.setValue(g.__min+(a.clientX-d.left)/(d.left+b-d.left)*(g.__max-g.__min));return!1}function k(){c.unbind(window,"mousemove",h);c.unbind(window,"mouseup",k);g.__onFinishChange&&g.__onFinishChange.call(g,g.getValue())}d.superclass.call(this,a,b,{min:f,max:e,step:p});var g=this;this.__background=document.createElement("div");
this.__foreground=document.createElement("div");c.bind(this.__background,"mousedown",function(a){c.bind(window,"mousemove",h);c.bind(window,"mouseup",k);h(a)});c.addClass(this.__background,"slider");c.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};d.superclass=a;d.useDefaultStyles=function(){e.inject(f)};b.extend(d.prototype,a.prototype,{updateDisplay:function(){this.__foreground.style.width=
(this.getValue()-this.__min)/(this.__max-this.__min)*100+"%";return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(a,c,e){var b=function(a,d,e){b.superclass.call(this,a,d);var f=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===e?"Fire":e;c.bind(this.__button,"click",function(a){a.preventDefault();f.fire();return!1});c.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};b.superclass=a;e.extend(b.prototype,a.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return b}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(a,c,e){var b=function(a,d){b.superclass.call(this,a,d);var f=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");c.bind(this.__checkbox,"change",function(){f.setValue(!f.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};b.superclass=a;e.extend(b.prototype,a.prototype,{setValue:function(a){a=b.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return b.superclass.prototype.updateDisplay.call(this)}});return b}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(a){return function(c){if(1==c.a||a.isUndefined(c.a)){for(c=c.hex.toString(16);6>c.length;)c="0"+c;return"#"+c}return"rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+c.a+")"}}(dat.utils.common);
dat.color.interpret=function(a,c){var e,b,f=[{litmus:c.isString,conversions:{THREE_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:a},SIX_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9]{6})$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:a},CSS_RGB:{read:function(a){a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:a},CSS_RGBA:{read:function(a){a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:a}}},{litmus:c.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:c.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=
a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:c.isObject,conversions:{RGBA_OBJ:{read:function(a){return c.isNumber(a.r)&&c.isNumber(a.g)&&c.isNumber(a.b)&&c.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return c.isNumber(a.r)&&
c.isNumber(a.g)&&c.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return c.isNumber(a.h)&&c.isNumber(a.s)&&c.isNumber(a.v)&&c.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return c.isNumber(a.h)&&c.isNumber(a.s)&&c.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return function(){b=!1;
var a=1<arguments.length?c.toArray(arguments):arguments[0];c.each(f,function(d){if(d.litmus(a))return c.each(d.conversions,function(d,f){e=d.read(a);if(!1===b&&!1!==e)return b=e,e.conversionName=f,e.conversion=d,c.BREAK}),c.BREAK});return b}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(a,c,e,b,f,d,k,h,l,n,p,v,B,g,m){function w(a,c,d,e){if(void 0===c[d])throw Error("Object "+c+' has no property "'+d+'"');e.color?c=new p(c,d):(c=[c,d].concat(e.factoryArgs),c=b.apply(a,c));e.before instanceof f&&(e.before=e.before.__li);y(a,c);g.addClass(c.domElement,"c");d=document.createElement("span");g.addClass(d,"property-name");d.innerHTML=c.property;var F=document.createElement("div");F.appendChild(d);F.appendChild(c.domElement);e=x(a,F,e.before);g.addClass(e,q.CLASS_CONTROLLER_ROW);
g.addClass(e,typeof c.getValue());t(a,e,c);a.__controllers.push(c);return c}function x(a,c,d){var b=document.createElement("li");c&&b.appendChild(c);d?a.__ul.insertBefore(b,params.before):a.__ul.appendChild(b);a.onResize();return b}function t(a,c,b){b.__li=c;b.__gui=a;m.extend(b,{options:function(c){if(1<arguments.length)return b.remove(),w(a,b.object,b.property,{before:b.__li.nextElementSibling,factoryArgs:[m.toArray(arguments)]});if(m.isArray(c)||m.isObject(c))return b.remove(),w(a,b.object,b.property,
{before:b.__li.nextElementSibling,factoryArgs:[c]})},name:function(a){b.__li.firstElementChild.firstElementChild.innerHTML=a;return b},listen:function(){b.__gui.listen(b);return b},remove:function(){b.__gui.remove(b);return b}});if(b instanceof l){var f=new h(b.object,b.property,{min:b.__min,max:b.__max,step:b.__step});m.each(["updateDisplay","onChange","onFinishChange"],function(a){var c=b[a],d=f[a];b[a]=f[a]=function(){var a=Array.prototype.slice.call(arguments);c.apply(b,a);return d.apply(f,a)}});
g.addClass(c,"has-slider");b.domElement.insertBefore(f.domElement,b.domElement.firstElementChild)}else if(b instanceof h){var e=function(c){return m.isNumber(b.__min)&&m.isNumber(b.__max)?(b.remove(),w(a,b.object,b.property,{before:b.__li.nextElementSibling,factoryArgs:[b.__min,b.__max,b.__step]})):c};b.min=m.compose(e,b.min);b.max=m.compose(e,b.max)}else b instanceof d?(g.bind(c,"click",function(){g.fakeEvent(b.__checkbox,"click")}),g.bind(b.__checkbox,"click",function(a){a.stopPropagation()})):
b instanceof k?(g.bind(c,"click",function(){g.fakeEvent(b.__button,"click")}),g.bind(c,"mouseover",function(){g.addClass(b.__button,"hover")}),g.bind(c,"mouseout",function(){g.removeClass(b.__button,"hover")})):b instanceof p&&(g.addClass(c,"color"),b.updateDisplay=m.compose(function(a){c.style.borderLeftColor=b.__color.toString();return a},b.updateDisplay),b.updateDisplay());b.setValue=m.compose(function(c){a.getRoot().__preset_select&&b.isModified()&&I(a.getRoot(),!0);return c},b.setValue)}function y(a,
b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(-1!=d){var f=c.__rememberedObjectIndecesToControllers[d];void 0===f&&(f={},c.__rememberedObjectIndecesToControllers[d]=f);f[b.property]=b;if(c.load&&c.load.remembered){c=c.load.remembered;if(c[a.preset])c=c[a.preset];else if(c[r])c=c[r];else return;c[d]&&void 0!==c[d][b.property]&&(d=c[d][b.property],b.initialValue=d,b.setValue(d))}}}function K(a){var b=a.__save_row=document.createElement("li");g.addClass(a.domElement,"has-save");a.__ul.insertBefore(b,
a.__ul.firstChild);g.addClass(b,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;";g.addClass(c,"button gears");var d=document.createElement("span");d.innerHTML="Save";g.addClass(d,"button");g.addClass(d,"save");var f=document.createElement("span");f.innerHTML="New";g.addClass(f,"button");g.addClass(f,"save-as");var e=document.createElement("span");e.innerHTML="Revert";g.addClass(e,"button");g.addClass(e,"revert");var F=a.__preset_select=document.createElement("select");a.load&&
a.load.remembered?m.each(a.load.remembered,function(b,c){J(a,c,c==a.preset)}):J(a,r,!1);g.bind(F,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value});b.appendChild(F);b.appendChild(c);b.appendChild(d);b.appendChild(f);b.appendChild(e);if(C){b=document.getElementById("dg-save-locally");var h=document.getElementById("dg-local-explain");b.style.display="block";b=document.getElementById("dg-local-storage");"true"===
localStorage.getItem(document.location.href+".isLocal")&&b.setAttribute("checked","checked");var n=function(){h.style.display=a.useLocalStorage?"block":"none"};n();g.bind(b,"change",function(){a.useLocalStorage=!a.useLocalStorage;n()})}var k=document.getElementById("dg-new-constructor");g.bind(k,"keydown",function(a){a.metaKey&&(67===a.which||67==a.keyCode)&&G.hide()});g.bind(c,"click",function(){k.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2);G.show();k.focus();k.select()});g.bind(d,"click",
function(){a.save()});g.bind(f,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)});g.bind(e,"click",function(){a.revert()})}function L(a){function b(b){b.preventDefault();f=b.clientX;g.addClass(a.__closeButton,q.CLASS_DRAG);g.bind(window,"mousemove",c);g.bind(window,"mouseup",d);return!1}function c(b){b.preventDefault();a.width+=f-b.clientX;a.onResize();f=b.clientX;return!1}function d(){g.removeClass(a.__closeButton,q.CLASS_DRAG);g.unbind(window,"mousemove",c);g.unbind(window,
"mouseup",d)}a.__resize_handle=document.createElement("div");m.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var f;g.bind(a.__resize_handle,"mousedown",b);g.bind(a.__closeButton,"mousedown",b);a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function D(a,b){a.domElement.style.width=b+"px";a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px");a.__closeButton&&(a.__closeButton.style.width=b+"px")}
function A(a,b){var c={};m.each(a.__rememberedObjects,function(d,f){var e={};m.each(a.__rememberedObjectIndecesToControllers[f],function(a,c){e[c]=b?a.initialValue:a.getValue()});c[f]=e});return c}function J(a,b,c){var d=document.createElement("option");d.innerHTML=b;d.value=b;a.__preset_select.appendChild(d);c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function I(a,b){a=a.__preset_select[a.__preset_select.selectedIndex];a.innerHTML=b?a.value+"*":a.value}function u(a){0!=a.length&&
v(function(){u(a)});m.each(a,function(a){a.updateDisplay()})}a.inject(e);var r="Default";try{var C="localStorage"in window&&null!==window.localStorage}catch(F){C=!1}var G,H=!0,z,E=!1,M=[],q=function(a){function b(){localStorage.setItem(document.location.href+".gui",JSON.stringify(f.getSaveObject()))}function c(){var a=f.getRoot();a.width+=1;m.defer(function(){--a.width})}var d,f=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);
g.addClass(this.domElement,"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];a=a||{};a=m.defaults(a,{autoPlace:!0,width:q.DEFAULT_WIDTH});a=m.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace});m.isUndefined(a.load)?a.load={preset:r}:a.preset&&(a.load.preset=a.preset);m.isUndefined(a.parent)&&a.hideable&&M.push(this);a.resizable=m.isUndefined(a.parent)&&a.resizable;a.autoPlace&&m.isUndefined(a.scrollable)&&
(a.scrollable=!0);var e=C&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return f.parent?f.getRoot().preset:a.load.preset},set:function(b){f.parent?f.getRoot().preset=b:a.load.preset=b;for(b=0;b<this.__preset_select.length;b++)this.__preset_select[b].value==this.preset&&(this.__preset_select.selectedIndex=
b);f.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b;D(f,b)}},name:{get:function(){return a.name},set:function(b){a.name=b;h&&(h.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(b){a.closed=b;a.closed?g.addClass(f.__ul,q.CLASS_CLOSED):g.removeClass(f.__ul,q.CLASS_CLOSED);this.onResize();f.__closeButton&&(f.__closeButton.innerHTML=b?q.TEXT_OPEN:q.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return e},set:function(a){C&&
((e=a)?g.bind(window,"unload",b):g.unbind(window,"unload",b),localStorage.setItem(document.location.href+".isLocal",a))}}});if(m.isUndefined(a.parent))a.closed=!1,g.addClass(this.domElement,q.CLASS_MAIN),g.makeSelectable(this.domElement,!1),C&&e&&(f.useLocalStorage=!0,d=localStorage.getItem(document.location.href+".gui"))&&(a.load=JSON.parse(d)),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=q.TEXT_CLOSED,g.addClass(this.__closeButton,q.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),
g.bind(this.__closeButton,"click",function(){f.closed=!f.closed});else{void 0===a.closed&&(a.closed=!0);var h=document.createTextNode(a.name);g.addClass(h,"controller-name");d=x(f,h);g.addClass(this.__ul,q.CLASS_CLOSED);g.addClass(d,"title");g.bind(d,"click",function(a){a.preventDefault();f.closed=!f.closed;return!1});a.closed||(this.closed=!1)}a.autoPlace&&(m.isUndefined(a.parent)&&(H&&(z=document.createElement("div"),g.addClass(z,"dg"),g.addClass(z,q.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(z),
H=!1),z.appendChild(this.domElement),g.addClass(this.domElement,q.CLASS_AUTO_PLACE)),this.parent||D(f,a.width));g.bind(window,"resize",function(){f.onResize()});g.bind(this.__ul,"webkitTransitionEnd",function(){f.onResize()});g.bind(this.__ul,"transitionend",function(){f.onResize()});g.bind(this.__ul,"oTransitionEnd",function(){f.onResize()});this.onResize();a.resizable&&L(this);f.getRoot();a.parent||c()};q.toggleHide=function(){E=!E;m.each(M,function(a){a.domElement.style.zIndex=E?-999:999;a.domElement.style.opacity=
E?0:1})};q.CLASS_AUTO_PLACE="a";q.CLASS_AUTO_PLACE_CONTAINER="ac";q.CLASS_MAIN="main";q.CLASS_CONTROLLER_ROW="cr";q.CLASS_TOO_TALL="taller-than-window";q.CLASS_CLOSED="closed";q.CLASS_CLOSE_BUTTON="close-button";q.CLASS_DRAG="drag";q.DEFAULT_WIDTH=245;q.TEXT_CLOSED="Close Controls";q.TEXT_OPEN="Open Controls";g.bind(window,"keydown",function(a){"text"===document.activeElement.type||72!==a.which&&72!=a.keyCode||q.toggleHide()},!1);m.extend(q.prototype,{add:function(a,b){return w(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(a,b){return w(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li);this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;m.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&z.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};b.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[a]&&
(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]);b=new q(b);this.__folders[a]=b;a=x(this,b.domElement);g.addClass(a,"folder");return b},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=g.getOffset(a.__ul).top,c=0;m.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=g.getHeight(b))});window.innerHeight-b-20<c?(g.addClass(a.domElement,q.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-
b-20+"px"):(g.removeClass(a.domElement,q.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&m.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"});a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){m.isUndefined(G)&&(G=new B,G.domElement.innerHTML=c);if(this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;m.each(Array.prototype.slice.call(arguments),function(b){0==a.__rememberedObjects.length&&K(a);-1==
a.__rememberedObjects.indexOf(b)&&a.__rememberedObjects.push(b)});this.autoPlace&&D(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;a.closed=this.closed;0<this.__rememberedObjects.length&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=A(this));a.folders={};m.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()});return a},save:function(){this.load.remembered||(this.load.remembered=
{});this.load.remembered[this.preset]=A(this);I(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered[r]=A(this,!0));this.load.remembered[a]=A(this);this.preset=a;J(this,a,!0)},revert:function(a){m.each(this.__controllers,function(b){this.getRoot().load.remembered?y(a||this.getRoot(),b):b.setValue(b.initialValue)},this);m.each(this.__folders,function(a){a.revert(a)});a||I(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a);
b&&u(this.__listening)}});return q}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(a,c,e,b,f,d,k){return function(h,l,n,p){var v=h[l];if(k.isArray(n)||k.isObject(n))return new a(h,l,n);if(k.isNumber(v))return k.isNumber(n)&&k.isNumber(p)?new e(h,l,n,p):new c(h,l,{min:n,max:p});if(k.isString(v))return new b(h,l);if(k.isFunction(v))return new f(h,l,"");if(k.isBoolean(v))return new d(h,l)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(a,c,e){var b=
function(a,d){function f(){e.setValue(e.__input.value)}b.superclass.call(this,a,d);var e=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");c.bind(this.__input,"keyup",f);c.bind(this.__input,"change",f);c.bind(this.__input,"blur",function(){e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())});c.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};b.superclass=a;e.extend(b.prototype,
a.prototype,{updateDisplay:function(){c.isActive(this.__input)||(this.__input.value=this.getValue());return b.superclass.prototype.updateDisplay.call(this)}});return b}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(a,c,e,b,f){function d(a,b,c,d){a.style.background="";f.each(l,function(f){a.style.cssText+="background: "+f+"linear-gradient("+b+", "+c+" 0%, "+d+" 100%); "})}function k(a){a.style.background="";a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var h=function(a,p){function l(a){w(a);c.bind(window,"mousemove",w);c.bind(window,
"mouseup",n)}function n(){c.unbind(window,"mousemove",w);c.unbind(window,"mouseup",n)}function g(){var a=b(this.value);!1!==a?(t.__color.__state=a,t.setValue(t.__color.toOriginal())):this.value=t.__color.toString()}function m(){c.unbind(window,"mousemove",x);c.unbind(window,"mouseup",m)}function w(a){a.preventDefault();var b=c.getWidth(t.__saturation_field),d=c.getOffset(t.__saturation_field),f=(a.clientX-d.left+document.body.scrollLeft)/b;a=1-(a.clientY-d.top+document.body.scrollTop)/b;1<a?a=1:0>
a&&(a=0);1<f?f=1:0>f&&(f=0);t.__color.v=a;t.__color.s=f;t.setValue(t.__color.toOriginal());return!1}function x(a){a.preventDefault();var b=c.getHeight(t.__hue_field),d=c.getOffset(t.__hue_field);a=1-(a.clientY-d.top+document.body.scrollTop)/b;1<a?a=1:0>a&&(a=0);t.__color.h=360*a;t.setValue(t.__color.toOriginal());return!1}h.superclass.call(this,a,p);this.__color=new e(this.getValue());this.__temp=new e(0);var t=this;this.domElement=document.createElement("div");c.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";c.bind(this.__input,"keydown",function(a){13===a.keyCode&&g.call(this)});c.bind(this.__input,"blur",g);c.bind(this.__selector,"mousedown",function(){c.addClass(this,"drag").bind(window,"mouseup",function(){c.removeClass(t.__selector,"drag")})});a=document.createElement("div");f.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});f.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});f.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});f.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});f.extend(a.style,{width:"100%",height:"100%",
background:"none"});d(a,"top","rgba(0,0,0,0)","#000");f.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});k(this.__hue_field);f.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});c.bind(this.__saturation_field,"mousedown",l);c.bind(this.__field_knob,"mousedown",l);c.bind(this.__hue_field,"mousedown",function(a){x(a);c.bind(window,
"mousemove",x);c.bind(window,"mouseup",m)});this.__saturation_field.appendChild(a);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};h.superclass=a;f.extend(h.prototype,a.prototype,{updateDisplay:function(){var a=b(this.getValue());if(!1!==a){var c=!1;
f.each(e.COMPONENTS,function(b){if(!f.isUndefined(a[b])&&!f.isUndefined(this.__color.__state[b])&&a[b]!==this.__color.__state[b])return c=!0,{}},this);c&&f.extend(this.__color.__state,a)}f.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var h=.5>this.__color.v||.5<this.__color.s?255:0,k=255-h;f.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+h+
","+h+","+h+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;d(this.__saturation_field,"left","#fff",this.__temp.toString());f.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+h+","+h+","+h+")",textShadow:this.__input_textShadow+"rgba("+k+","+k+","+k+",.7)"})}});var l=["-moz-","-o-","-webkit-","-ms-",""];return h}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(a,c,e,b){function f(a,
b,c){Object.defineProperty(a,b,{get:function(){if("RGB"===this.__state.space)return this.__state[b];k(this,b,c);return this.__state[b]},set:function(a){"RGB"!==this.__state.space&&(k(this,b,c),this.__state.space="RGB");this.__state[b]=a}})}function d(a,b){Object.defineProperty(a,b,{get:function(){if("HSV"===this.__state.space)return this.__state[b];h(this);return this.__state[b]},set:function(a){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV");this.__state[b]=a}})}function k(a,d,f){if("HEX"===
a.__state.space)a.__state[d]=c.component_from_hex(a.__state.hex,f);else if("HSV"===a.__state.space)b.extend(a.__state,c.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v));else throw"Corrupted color state";}function h(a){var d=c.rgb_to_hsv(a.r,a.g,a.b);b.extend(a.__state,{s:d.s,v:d.v});b.isNaN(d.h)?b.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=d.h}var l=function(){this.__state=a.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};l.COMPONENTS="r g b h s v hex a".split(" ");b.extend(l.prototype,{toString:function(){return e(this)},toOriginal:function(){return this.__state.conversion.write(this)}});f(l.prototype,"r",2);f(l.prototype,"g",1);f(l.prototype,"b",0);d(l.prototype,"h");d(l.prototype,"s");d(l.prototype,"v");Object.defineProperty(l.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}});Object.defineProperty(l.prototype,"hex",{get:function(){this.__state.hex=c.rgb_to_hex(this.r,this.g,
this.b);return this.__state.hex},set:function(a){this.__state.space="HEX";this.__state.hex=a}});return l}(dat.color.interpret,dat.color.math=function(){var a;return{hsv_to_rgb:function(a,e,b){var c=a/60-Math.floor(a/60),d=b*(1-e),k=b*(1-c*e);e=b*(1-(1-c)*e);a=[[b,e,d],[k,b,d],[d,b,e],[d,k,b],[e,d,b],[b,d,k]][Math.floor(a/60)%6];return{r:255*a[0],g:255*a[1],b:255*a[2]}},rgb_to_hsv:function(a,e,b){var c=Math.min(a,e,b),d=Math.max(a,e,b),c=d-c;if(0==d)return{h:NaN,s:0,v:0};a=(a==d?(e-b)/c:e==d?2+(b-
a)/c:4+(a-e)/c)/6;0>a&&(a+=1);return{h:360*a,s:c/d,v:d/255}},rgb_to_hex:function(a,e,b){a=this.hex_with_component(0,2,a);a=this.hex_with_component(a,1,e);return this.hex_with_component(a,0,b)},component_from_hex:function(a,e){return a>>8*e&255},hex_with_component:function(c,e,b){return b<<(a=8*e)|c&~(255<<a)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}(),dat.dom.CenteredDiv=function(a,c){var e=function(){this.backgroundElement=document.createElement("div");c.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});a.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=
document.createElement("div");c.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var b=this;a.bind(this.backgroundElement,"click",function(){b.hide()})};e.prototype.show=function(){var a=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=
0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();c.defer(function(){a.backgroundElement.style.opacity=1;a.domElement.style.opacity=1;a.domElement.style.webkitTransform="scale(1)"})};e.prototype.hide=function(){var b=this,c=function(){b.domElement.style.display="none";b.backgroundElement.style.display="none";a.unbind(b.domElement,"webkitTransitionEnd",c);a.unbind(b.domElement,"transitionend",c);a.unbind(b.domElement,"oTransitionEnd",c)};a.bind(this.domElement,"webkitTransitionEnd",
c);a.bind(this.domElement,"transitionend",c);a.bind(this.domElement,"oTransitionEnd",c);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};e.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-a.getHeight(this.domElement)/2+"px"};return e}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);THREE.OrbitControls=function(a,c){function e(a){if(!1!==d.enabled){a.preventDefault();var b=d.domElement===document?d.domElement.body:d.domElement;if(r===u.ROTATE){if(!0===d.noRotate)return;h.set(a.clientX,a.clientY);l.subVectors(h,k);d.rotateLeft(2*Math.PI*l.x/b.clientWidth*d.rotateSpeed);d.rotateUp(2*Math.PI*l.y/b.clientHeight*d.rotateSpeed);k.copy(h)}else if(r===u.DOLLY){if(!0===d.noZoom)return;w.set(a.clientX,a.clientY);x.subVectors(w,m);0<x.y?d.dollyIn():0>x.y&&d.dollyOut();m.copy(w)}else if(r===
u.PAN){if(!0===d.noPan)return;p.set(a.clientX,a.clientY);v.subVectors(p,n);d.pan(v.x,v.y);n.copy(p)}r!==u.NONE&&d.update()}}function b(){!1!==d.enabled&&(document.removeEventListener("mousemove",e,!1),document.removeEventListener("mouseup",b,!1),d.dispatchEvent(E),r=u.NONE)}function f(a){if(!1!==d.enabled&&!0!==d.noZoom&&r===u.NONE){a.preventDefault();a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);0<b?d.dollyOut():0>b&&d.dollyIn();d.update();d.dispatchEvent(z);
d.dispatchEvent(E)}}this.object=a;this.domElement=void 0!==c?c:document;this.enabled=!0;this.center=this.target=new THREE.Vector3;this.noZoom=!1;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.noRotate=!1;this.rotateSpeed=1;this.noPan=!1;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.noKeys=!1;this.keys={LEFT:37,UP:38,
RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var d=this,k=new THREE.Vector2,h=new THREE.Vector2,l=new THREE.Vector2,n=new THREE.Vector2,p=new THREE.Vector2,v=new THREE.Vector2,B=new THREE.Vector3,g=new THREE.Vector3,m=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2,t,y,K=0,L=0,D=1,A=new THREE.Vector3,J=new THREE.Vector3,I=new THREE.Quaternion,u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},r=u.NONE;
this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;var C=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),G=C.clone().inverse(),H={type:"change"},z={type:"start"},E={type:"end"};this.rotateLeft=function(a){void 0===a&&(a=2*Math.PI/60/60*d.autoRotateSpeed);L-=a};this.rotateUp=function(a){void 0===a&&(a=2*Math.PI/60/60*d.autoRotateSpeed);K-=a};this.panLeft=function(a){var b=this.object.matrix.elements;B.set(b[0],b[1],b[2]);
B.multiplyScalar(-a);A.add(B)};this.panUp=function(a){var b=this.object.matrix.elements;B.set(b[4],b[5],b[6]);B.multiplyScalar(a);A.add(B)};this.pan=function(a,b){var c=d.domElement===document?d.domElement.body:d.domElement;if(d.object instanceof THREE.PerspectiveCamera){var f=d.object.position.clone().sub(d.target).length(),f=f*Math.tan(d.object.fov/2*Math.PI/180);d.panLeft(2*a*f/c.clientHeight);d.panUp(2*b*f/c.clientHeight)}else d.object instanceof THREE.OrthographicCamera?(d.panLeft(a*(d.object.right-
d.object.left)/c.clientWidth),d.panUp(b*(d.object.top-d.object.bottom)/c.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,d.zoomSpeed));d.object instanceof THREE.PerspectiveCamera?D/=a:d.object instanceof THREE.OrthographicCamera?(d.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*a)),d.object.updateProjectionMatrix(),d.dispatchEvent(H)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")};
this.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,d.zoomSpeed));d.object instanceof THREE.PerspectiveCamera?D*=a:d.object instanceof THREE.OrthographicCamera?(d.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/a)),d.object.updateProjectionMatrix(),d.dispatchEvent(H)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")};this.update=function(){var a=this.object.position;g.copy(a).sub(this.target);g.applyQuaternion(C);t=Math.atan2(g.x,
g.z);y=Math.atan2(Math.sqrt(g.x*g.x+g.z*g.z),g.y);this.autoRotate&&r===u.NONE&&this.rotateLeft(2*Math.PI/60/60*d.autoRotateSpeed);t+=L;y+=K;t=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t));y=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,y));y=Math.max(1E-6,Math.min(Math.PI-1E-6,y));var b=g.length()*D,b=Math.max(this.minDistance,Math.min(this.maxDistance,b));this.target.add(A);g.x=b*Math.sin(y)*Math.sin(t);g.y=b*Math.cos(y);g.z=b*Math.sin(y)*Math.cos(t);g.applyQuaternion(G);
a.copy(this.target).add(g);this.object.lookAt(this.target);K=L=0;D=1;A.set(0,0,0);if(1E-6<J.distanceToSquared(this.object.position)||1E-6<8*(1-I.dot(this.object.quaternion)))this.dispatchEvent(H),J.copy(this.object.position),I.copy(this.object.quaternion)};this.reset=function(){r=u.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.object.zoom=this.zoom0;this.object.updateProjectionMatrix();this.dispatchEvent(H);this.update()};this.getPolarAngle=function(){return y};
this.getAzimuthalAngle=function(){return t};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(a){if(!1!==d.enabled){a.preventDefault();if(a.button===d.mouseButtons.ORBIT){if(!0===d.noRotate)return;r=u.ROTATE;k.set(a.clientX,a.clientY)}else if(a.button===d.mouseButtons.ZOOM){if(!0===d.noZoom)return;r=u.DOLLY;m.set(a.clientX,a.clientY)}else if(a.button===d.mouseButtons.PAN){if(!0===d.noPan)return;r=u.PAN;n.set(a.clientX,
a.clientY)}r!==u.NONE&&(document.addEventListener("mousemove",e,!1),document.addEventListener("mouseup",b,!1),d.dispatchEvent(z))}},!1);this.domElement.addEventListener("mousewheel",f,!1);this.domElement.addEventListener("DOMMouseScroll",f,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==d.enabled){switch(a.touches.length){case 1:if(!0===d.noRotate)return;r=u.TOUCH_ROTATE;k.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(!0===d.noZoom)return;r=u.TOUCH_DOLLY;var b=a.touches[0].pageX-
a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;m.set(0,Math.sqrt(b*b+a*a));break;case 3:if(!0===d.noPan)return;r=u.TOUCH_PAN;n.set(a.touches[0].pageX,a.touches[0].pageY);break;default:r=u.NONE}r!==u.NONE&&d.dispatchEvent(z)}},!1);this.domElement.addEventListener("touchend",function(){!1!==d.enabled&&(d.dispatchEvent(E),r=u.NONE)},!1);this.domElement.addEventListener("touchmove",function(a){if(!1!==d.enabled){a.preventDefault();a.stopPropagation();var b=d.domElement===document?d.domElement.body:
d.domElement;switch(a.touches.length){case 1:if(!0===d.noRotate)break;if(r!==u.TOUCH_ROTATE)break;h.set(a.touches[0].pageX,a.touches[0].pageY);l.subVectors(h,k);d.rotateLeft(2*Math.PI*l.x/b.clientWidth*d.rotateSpeed);d.rotateUp(2*Math.PI*l.y/b.clientHeight*d.rotateSpeed);k.copy(h);d.update();break;case 2:if(!0===d.noZoom)break;if(r!==u.TOUCH_DOLLY)break;b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;w.set(0,Math.sqrt(b*b+a*a));x.subVectors(w,m);0<x.y?d.dollyOut():
0>x.y&&d.dollyIn();m.copy(w);d.update();break;case 3:if(!0===d.noPan)break;if(r!==u.TOUCH_PAN)break;p.set(a.touches[0].pageX,a.touches[0].pageY);v.subVectors(p,n);d.pan(v.x,v.y);n.copy(p);d.update();break;default:r=u.NONE}}},!1);window.addEventListener("keydown",function(a){if(!1!==d.enabled&&!0!==d.noKeys&&!0!==d.noPan)switch(a.keyCode){case d.keys.UP:d.pan(0,d.keyPanSpeed);d.update();break;case d.keys.BOTTOM:d.pan(0,-d.keyPanSpeed);d.update();break;case d.keys.LEFT:d.pan(d.keyPanSpeed,0);d.update();
break;case d.keys.RIGHT:d.pan(-d.keyPanSpeed,0),d.update()}},!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;(function(a){"object"===typeof exports&&"undefined"!==typeof module?module.exports=a():"function"===typeof define&&define.amd?define([],a):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).GIF=a()})(function(){return function c(e,b,f){function d(h,n){if(!b[h]){if(!e[h]){var l="function"==typeof require&&require;if(!n&&l)return l(h,!0);if(k)return k(h,!0);n=Error("Cannot find module '"+h+"'");throw n.code="MODULE_NOT_FOUND",n;}n=b[h]={exports:{}};
e[h][0].call(n.exports,function(b){var c=e[h][1][b];return d(c?c:b)},n,n.exports,c,e,b,f)}return b[h].exports}for(var k="function"==typeof require&&require,h=0;h<f.length;h++)d(f[h]);return d}({1:[function(c,e,b){function f(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function d(b){return"function"===typeof b}function k(b){return"object"===typeof b&&null!==b}e.exports=f;f.EventEmitter=f;f.prototype._events=void 0;f.prototype._maxListeners=void 0;f.defaultMaxListeners=
10;f.prototype.setMaxListeners=function(b){if("number"!==typeof b||0>b||isNaN(b))throw TypeError("n must be a positive number");this._maxListeners=b;return this};f.prototype.emit=function(b){var c;this._events||(this._events={});if("error"===b&&(!this._events.error||k(this._events.error)&&!this._events.error.length)){var f=arguments[1];if(f instanceof Error)throw f;var e=Error('Uncaught, unspecified "error" event. ('+f+")");e.context=f;throw e;}e=this._events[b];if(void 0===e)return!1;if(d(e))switch(arguments.length){case 1:e.call(this);
break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),e.apply(this,f)}else if(k(e)){f=Array.prototype.slice.call(arguments,1);var h=e.slice();e=h.length;for(c=0;c<e;c++)h[c].apply(this,f)}return!0};f.prototype.addListener=function(b,c){if(!d(c))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",b,d(c.listener)?c.listener:c);this._events[b]?
k(this._events[b])?this._events[b].push(c):this._events[b]=[this._events[b],c]:this._events[b]=c;k(this._events[b])&&!this._events[b].warned&&(c=void 0!==this._maxListeners?this._maxListeners:f.defaultMaxListeners)&&0<c&&this._events[b].length>c&&(this._events[b].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[b].length),"function"===typeof console.trace&&console.trace());return this};
f.prototype.on=f.prototype.addListener;f.prototype.once=function(b,c){function f(){this.removeListener(b,f);e||(e=!0,c.apply(this,arguments))}if(!d(c))throw TypeError("listener must be a function");var e=!1;f.listener=c;this.on(b,f);return this};f.prototype.removeListener=function(b,c){if(!d(c))throw TypeError("listener must be a function");if(!this._events||!this._events[b])return this;var f=this._events[b];var e=f.length;var h=-1;if(f===c||d(f.listener)&&f.listener===c)delete this._events[b],this._events.removeListener&&
this.emit("removeListener",b,c);else if(k(f)){for(;0<e--;)if(f[e]===c||f[e].listener&&f[e].listener===c){h=e;break}if(0>h)return this;1===f.length?(f.length=0,delete this._events[b]):f.splice(h,1);this._events.removeListener&&this.emit("removeListener",b,c)}return this};f.prototype.removeAllListeners=function(b){if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[b]&&delete this._events[b],this;if(0===arguments.length){for(c in this._events)"removeListener"!==
c&&this.removeAllListeners(c);this.removeAllListeners("removeListener");this._events={};return this}var c=this._events[b];if(d(c))this.removeListener(b,c);else if(c)for(;c.length;)this.removeListener(b,c[c.length-1]);delete this._events[b];return this};f.prototype.listeners=function(b){return this._events&&this._events[b]?d(this._events[b])?[this._events[b]]:this._events[b].slice():[]};f.prototype.listenerCount=function(b){if(this._events){b=this._events[b];if(d(b))return 1;if(b)return b.length}return 0};
f.listenerCount=function(b,c){return b.listenerCount(c)}},{}],2:[function(c,e,b){var f=navigator.userAgent.toLowerCase();b=navigator.platform.toLowerCase();c=f.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0];c={name:"version"===c[1]?c[3]:c[1],version:"ie"===c[1]&&document.documentMode||parseFloat("opera"===c[1]&&c[4]?c[4]:c[2]),platform:{name:f.match(/ip(?:ad|od|hone)/)?"ios":(f.match(/(?:webos|android)/)||b.match(/mac|win|linux/)||
["other"])[0]}};c[c.name]=!0;c[c.name+parseInt(c.version,10)]=!0;c.platform[c.platform.name]=!0;e.exports=c},{}],3:[function(c,e,b){var f=function(b,c){function f(){this.constructor=b}for(var e in c)d.call(c,e)&&(b[e]=c[e]);f.prototype=c.prototype;b.prototype=new f;b.__super__=c.prototype;return b},d={}.hasOwnProperty,k=[].indexOf||function(b){for(var c=0,d=this.length;c<d;c++)if(c in this&&this[c]===b)return c;return-1},h=[].slice;b=c("events").EventEmitter;var l=c("./browser.coffee");c=function(b){function c(b){var c,
d;this.running=!1;this.options={};this.frames=[];this.freeWorkers=[];this.activeWorkers=[];this.setOptions(b);for(d in e)b=e[d],null==(c=this.options)[d]&&(c[d]=b)}f(c,b);var e={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1};var n={delay:500,copy:!1};c.prototype.setOption=function(b,c){this.options[b]=c;if(null!=this._canvas&&("width"===b||"height"===b))return this._canvas[b]=c};c.prototype.setOptions=function(b){var c;
var f=[];for(c in b)if(d.call(b,c)){var e=b[c];f.push(this.setOption(c,e))}return f};c.prototype.addFrame=function(b,c){var d;null==c&&(c={});var f={};f.transparent=this.options.transparent;for(d in n)f[d]=c[d]||n[d];null==this.options.width&&this.setOption("width",b.width);null==this.options.height&&this.setOption("height",b.height);if("undefined"!==typeof ImageData&&null!==ImageData&&b instanceof ImageData)f.data=b.data;else if("undefined"!==typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&
b instanceof CanvasRenderingContext2D||"undefined"!==typeof WebGL2RenderingContext&&null!==WebGL2RenderingContext&&b instanceof WebGL2RenderingContext)c.copy?f.data=this.getContextData(b):f.context=b;else if(null!=b.childNodes)c.copy?f.data=this.getImageData(b):f.image=b;else throw Error("Invalid image");return this.frames.push(f)};c.prototype.render=function(){var b;if(this.running)throw Error("Already running");if(null==this.options.width||null==this.options.height)throw Error("Width and height must be set prior to rendering");
this.running=!0;this.finishedFrames=this.nextFrame=0;var c=[];var d=0;for(b=this.frames.length;0<=b?d<b:d>b;0<=b?++d:--d)c.push(null);this.imageParts=c;b=this.spawnWorkers();if(!0===this.options.globalPalette)this.renderNextFrame();else for(d=0;0<=b?d<b:d>b;0<=b?++d:--d)this.renderNextFrame();this.emit("start");return this.emit("progress",0)};c.prototype.abort=function(){for(var b;;){b=this.activeWorkers.shift();if(null==b)break;this.log("killing active worker");b.terminate()}this.running=!1;return this.emit("abort")};
c.prototype.spawnWorkers=function(){var b,c;var d=Math.min(this.options.workers,this.frames.length);(function(){c=[];for(var f=b=this.freeWorkers.length;b<=d?f<d:f>d;b<=d?f++:f--)c.push(f);return c}).apply(this).forEach(function(b){return function(c){b.log("spawning worker "+c);var d=new Worker(b.options.workerScript);d.onmessage=function(c){b.activeWorkers.splice(b.activeWorkers.indexOf(d),1);b.freeWorkers.push(d);return b.frameFinished(c.data)};return b.freeWorkers.push(d)}}(this));return d};c.prototype.frameFinished=
function(b){var c;this.log("frame "+b.index+" finished - "+this.activeWorkers.length+" active");this.finishedFrames++;this.emit("progress",this.finishedFrames/this.frames.length);this.imageParts[b.index]=b;if(!0===this.options.globalPalette&&(this.options.globalPalette=b.globalPalette,this.log("global palette analyzed"),2<this.frames.length))for(b=1,c=this.freeWorkers.length;1<=c?b<c:b>c;1<=c?++b:--b)this.renderNextFrame();return 0<=k.call(this.imageParts,null)?this.renderNextFrame():this.finishRendering()};
c.prototype.finishRendering=function(){var b,c,d;var f=0;var e=this.imageParts;var k=0;for(b=e.length;k<b;k++){var h=e[k];f+=(h.data.length-1)*h.pageSize+h.cursor}f+=h.pageSize-h.cursor;this.log("rendering finished - filesize "+Math.round(f/1E3)+"kb");k=new Uint8Array(f);var l=0;var n=this.imageParts;b=0;for(c=n.length;b<c;b++){h=n[b];var p=h.data;f=e=0;for(d=p.length;e<d;f=++e){var v=p[f];k.set(v,l);l=f===h.data.length-1?l+h.cursor:l+h.pageSize}}h=new Blob([k],{type:"image/gif"});return this.emit("finished",
h,k)};c.prototype.renderNextFrame=function(){if(0===this.freeWorkers.length)throw Error("No free workers");if(!(this.nextFrame>=this.frames.length)){var b=this.frames[this.nextFrame++];var c=this.freeWorkers.shift();b=this.getTask(b);this.log("starting frame "+(b.index+1)+" of "+this.frames.length);this.activeWorkers.push(c);return c.postMessage(b)}};c.prototype.getContextData=function(b){return b.getImageData(0,0,this.options.width,this.options.height).data};c.prototype.getImageData=function(b){null==
this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height);var c=this._canvas.getContext("2d");c.setFill=this.options.background;c.fillRect(0,0,this.options.width,this.options.height);c.drawImage(b,0,0);return this.getContextData(c)};c.prototype.getTask=function(b){var c=this.frames.indexOf(b);c={index:c,last:c===this.frames.length-1,delay:b.delay,transparent:b.transparent,width:this.options.width,height:this.options.height,
quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===l.name};if(null!=b.data)c.data=b.data;else if(null!=b.context)c.data=this.getContextData(b.context);else if(null!=b.image)c.data=this.getImageData(b.image);else throw Error("Invalid frame");return c};c.prototype.log=function(){var b=1<=arguments.length?h.call(arguments,0):[];if(this.options.debug)return console.log.apply(console,b)};return c}(b);e.exports=
c},{"./browser.coffee":2,events:1}]},{},[3])(3)});var gifworker_code='\n// gif.worker.js 0.2.0 - https://github.com/jnordberg/gif.js\n(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module \'"+o+"\'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var NeuQuant=require("./TypedNeuQuant.js");var LZWEncoder=require("./LZWEncoder.js");function ByteArray(){this.page=-1;this.pages=[];this.newPage()}ByteArray.pageSize=4096;ByteArray.charMap={};for(var i=0;i<256;i++)ByteArray.charMap[i]=String.fromCharCode(i);ByteArray.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(ByteArray.pageSize);this.cursor=0};ByteArray.prototype.getData=function(){var rv="";for(var p=0;p<this.pages.length;p++){for(var i=0;i<ByteArray.pageSize;i++){rv+=ByteArray.charMap[this.pages[p][i]]}}return rv};ByteArray.prototype.writeByte=function(val){if(this.cursor>=ByteArray.pageSize)this.newPage();this.pages[this.page][this.cursor++]=val};ByteArray.prototype.writeUTFBytes=function(string){for(var l=string.length,i=0;i<l;i++)this.writeByte(string.charCodeAt(i))};ByteArray.prototype.writeBytes=function(array,offset,length){for(var l=length||array.length,i=offset||0;i<l;i++)this.writeByte(array[i])};function GIFEncoder(width,height){this.width=~~width;this.height=~~height;this.transparent=null;this.transIndex=0;this.repeat=-1;this.delay=0;this.image=null;this.pixels=null;this.indexedPixels=null;this.colorDepth=null;this.colorTab=null;this.neuQuant=null;this.usedEntry=new Array;this.palSize=7;this.dispose=-1;this.firstFrame=true;this.sample=10;this.dither=false;this.globalPalette=false;this.out=new ByteArray}GIFEncoder.prototype.setDelay=function(milliseconds){this.delay=Math.round(milliseconds/10)};GIFEncoder.prototype.setFrameRate=function(fps){this.delay=Math.round(100/fps)};GIFEncoder.prototype.setDispose=function(disposalCode){if(disposalCode>=0)this.dispose=disposalCode};GIFEncoder.prototype.setRepeat=function(repeat){this.repeat=repeat};GIFEncoder.prototype.setTransparent=function(color){this.transparent=color};GIFEncoder.prototype.addFrame=function(imageData){this.image=imageData;this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null;this.getImagePixels();this.analyzePixels();if(this.globalPalette===true)this.globalPalette=this.colorTab;if(this.firstFrame){this.writeLSD();this.writePalette();if(this.repeat>=0){this.writeNetscapeExt()}}this.writeGraphicCtrlExt();this.writeImageDesc();if(!this.firstFrame&&!this.globalPalette)this.writePalette();this.writePixels();this.firstFrame=false};GIFEncoder.prototype.finish=function(){this.out.writeByte(59)};GIFEncoder.prototype.setQuality=function(quality){if(quality<1)quality=1;this.sample=quality};GIFEncoder.prototype.setDither=function(dither){if(dither===true)dither="FloydSteinberg";this.dither=dither};GIFEncoder.prototype.setGlobalPalette=function(palette){this.globalPalette=palette};GIFEncoder.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette};GIFEncoder.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")};GIFEncoder.prototype.analyzePixels=function(){if(!this.colorTab){this.neuQuant=new NeuQuant(this.pixels,this.sample);this.neuQuant.buildColormap();this.colorTab=this.neuQuant.getColormap()}if(this.dither){this.ditherPixels(this.dither.replace("-serpentine",""),this.dither.match(/-serpentine/)!==null)}else{this.indexPixels()}this.pixels=null;this.colorDepth=8;this.palSize=7;if(this.transparent!==null){this.transIndex=this.findClosest(this.transparent,true)}};GIFEncoder.prototype.indexPixels=function(imgq){var nPix=this.pixels.length/3;this.indexedPixels=new Uint8Array(nPix);var k=0;for(var j=0;j<nPix;j++){var index=this.findClosestRGB(this.pixels[k++]&255,this.pixels[k++]&255,this.pixels[k++]&255);this.usedEntry[index]=true;this.indexedPixels[j]=index}};GIFEncoder.prototype.ditherPixels=function(kernel,serpentine){var kernels={FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[2/8,1,1]],FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]]};if(!kernel||!kernels[kernel]){throw"Unknown dithering kernel: "+kernel}var ds=kernels[kernel];var index=0,height=this.height,width=this.width,data=this.pixels;var direction=serpentine?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(var y=0;y<height;y++){if(serpentine)direction=direction*-1;for(var x=direction==1?0:width-1,xend=direction==1?width:0;x!==xend;x+=direction){index=y*width+x;var idx=index*3;var r1=data[idx];var g1=data[idx+1];var b1=data[idx+2];idx=this.findClosestRGB(r1,g1,b1);this.usedEntry[idx]=true;this.indexedPixels[index]=idx;idx*=3;var r2=this.colorTab[idx];var g2=this.colorTab[idx+1];var b2=this.colorTab[idx+2];var er=r1-r2;var eg=g1-g2;var eb=b1-b2;for(var i=direction==1?0:ds.length-1,end=direction==1?ds.length:0;i!==end;i+=direction){var x1=ds[i][1];var y1=ds[i][2];if(x1+x>=0&&x1+x<width&&y1+y>=0&&y1+y<height){var d=ds[i][0];idx=index+x1+y1*width;idx*=3;data[idx]=Math.max(0,Math.min(255,data[idx]+er*d));data[idx+1]=Math.max(0,Math.min(255,data[idx+1]+eg*d));data[idx+2]=Math.max(0,Math.min(255,data[idx+2]+eb*d))}}}}};GIFEncoder.prototype.findClosest=function(c,used){return this.findClosestRGB((c&16711680)>>16,(c&65280)>>8,c&255,used)};GIFEncoder.prototype.findClosestRGB=function(r,g,b,used){if(this.colorTab===null)return-1;if(this.neuQuant&&!used){return this.neuQuant.lookupRGB(r,g,b)}var c=b|g<<8|r<<16;var minpos=0;var dmin=256*256*256;var len=this.colorTab.length;for(var i=0,index=0;i<len;index++){var dr=r-(this.colorTab[i++]&255);var dg=g-(this.colorTab[i++]&255);var db=b-(this.colorTab[i++]&255);var d=dr*dr+dg*dg+db*db;if((!used||this.usedEntry[index])&&d<dmin){dmin=d;minpos=index}}return minpos};GIFEncoder.prototype.getImagePixels=function(){var w=this.width;var h=this.height;this.pixels=new Uint8Array(w*h*3);var data=this.image;var srcPos=0;var count=0;for(var i=0;i<h;i++){for(var j=0;j<w;j++){this.pixels[count++]=data[srcPos++];this.pixels[count++]=data[srcPos++];this.pixels[count++]=data[srcPos++];srcPos++}}};GIFEncoder.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33);this.out.writeByte(249);this.out.writeByte(4);var transp,disp;if(this.transparent===null){transp=0;disp=0}else{transp=1;disp=2}if(this.dispose>=0){disp=dispose&7}disp<<=2;this.out.writeByte(0|disp|0|transp);this.writeShort(this.delay);this.out.writeByte(this.transIndex);this.out.writeByte(0)};GIFEncoder.prototype.writeImageDesc=function(){this.out.writeByte(44);this.writeShort(0);this.writeShort(0);this.writeShort(this.width);this.writeShort(this.height);if(this.firstFrame||this.globalPalette){this.out.writeByte(0)}else{this.out.writeByte(128|0|0|0|this.palSize)}};GIFEncoder.prototype.writeLSD=function(){this.writeShort(this.width);this.writeShort(this.height);this.out.writeByte(128|112|0|this.palSize);this.out.writeByte(0);this.out.writeByte(0)};GIFEncoder.prototype.writeNetscapeExt=function(){this.out.writeByte(33);this.out.writeByte(255);this.out.writeByte(11);this.out.writeUTFBytes("NETSCAPE2.0");this.out.writeByte(3);this.out.writeByte(1);this.writeShort(this.repeat);this.out.writeByte(0)};GIFEncoder.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var n=3*256-this.colorTab.length;for(var i=0;i<n;i++)this.out.writeByte(0)};GIFEncoder.prototype.writeShort=function(pValue){this.out.writeByte(pValue&255);this.out.writeByte(pValue>>8&255)};GIFEncoder.prototype.writePixels=function(){var enc=new LZWEncoder(this.width,this.height,this.indexedPixels,this.colorDepth);enc.encode(this.out)};GIFEncoder.prototype.stream=function(){return this.out};module.exports=GIFEncoder},{"./LZWEncoder.js":2,"./TypedNeuQuant.js":3}],2:[function(require,module,exports){var EOF=-1;var BITS=12;var HSIZE=5003;var masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function LZWEncoder(width,height,pixels,colorDepth){var initCodeSize=Math.max(2,colorDepth);var accum=new Uint8Array(256);var htab=new Int32Array(HSIZE);var codetab=new Int32Array(HSIZE);var cur_accum,cur_bits=0;var a_count;var free_ent=0;var maxcode;var clear_flg=false;var g_init_bits,ClearCode,EOFCode;function char_out(c,outs){accum[a_count++]=c;if(a_count>=254)flush_char(outs)}function cl_block(outs){cl_hash(HSIZE);free_ent=ClearCode+2;clear_flg=true;output(ClearCode,outs)}function cl_hash(hsize){for(var i=0;i<hsize;++i)htab[i]=-1}function compress(init_bits,outs){var fcode,c,i,ent,disp,hsize_reg,hshift;g_init_bits=init_bits;clear_flg=false;n_bits=g_init_bits;maxcode=MAXCODE(n_bits);ClearCode=1<<init_bits-1;EOFCode=ClearCode+1;free_ent=ClearCode+2;a_count=0;ent=nextPixel();hshift=0;for(fcode=HSIZE;fcode<65536;fcode*=2)++hshift;hshift=8-hshift;hsize_reg=HSIZE;cl_hash(hsize_reg);output(ClearCode,outs);outer_loop:while((c=nextPixel())!=EOF){fcode=(c<<BITS)+ent;i=c<<hshift^ent;if(htab[i]===fcode){ent=codetab[i];continue}else if(htab[i]>=0){disp=hsize_reg-i;if(i===0)disp=1;do{if((i-=disp)<0)i+=hsize_reg;if(htab[i]===fcode){ent=codetab[i];continue outer_loop}}while(htab[i]>=0)}output(ent,outs);ent=c;if(free_ent<1<<BITS){codetab[i]=free_ent++;htab[i]=fcode}else{cl_block(outs)}}output(ent,outs);output(EOFCode,outs)}function encode(outs){outs.writeByte(initCodeSize);remaining=width*height;curPixel=0;compress(initCodeSize+1,outs);outs.writeByte(0)}function flush_char(outs){if(a_count>0){outs.writeByte(a_count);outs.writeBytes(accum,0,a_count);a_count=0}}function MAXCODE(n_bits){return(1<<n_bits)-1}function nextPixel(){if(remaining===0)return EOF;--remaining;var pix=pixels[curPixel++];return pix&255}function output(code,outs){cur_accum&=masks[cur_bits];if(cur_bits>0)cur_accum|=code<<cur_bits;else cur_accum=code;cur_bits+=n_bits;while(cur_bits>=8){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}if(free_ent>maxcode||clear_flg){if(clear_flg){maxcode=MAXCODE(n_bits=g_init_bits);clear_flg=false}else{++n_bits;if(n_bits==BITS)maxcode=1<<BITS;else maxcode=MAXCODE(n_bits)}}if(code==EOFCode){while(cur_bits>0){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}flush_char(outs)}}this.encode=encode}module.exports=LZWEncoder},{}],3:[function(require,module,exports){var ncycles=100;var netsize=256;var maxnetpos=netsize-1;var netbiasshift=4;var intbiasshift=16;var intbias=1<<intbiasshift;var gammashift=10;var gamma=1<<gammashift;var betashift=10;var beta=intbias>>betashift;var betagamma=intbias<<gammashift-betashift;var initrad=netsize>>3;var radiusbiasshift=6;var radiusbias=1<<radiusbiasshift;var initradius=initrad*radiusbias;var radiusdec=30;var alphabiasshift=10;var initalpha=1<<alphabiasshift;var alphadec;var radbiasshift=8;var radbias=1<<radbiasshift;var alpharadbshift=alphabiasshift+radbiasshift;var alpharadbias=1<<alpharadbshift;var prime1=499;var prime2=491;var prime3=487;var prime4=503;var minpicturebytes=3*prime4;function NeuQuant(pixels,samplefac){var network;var netindex;var bias;var freq;var radpower;function init(){network=[];netindex=new Int32Array(256);bias=new Int32Array(netsize);freq=new Int32Array(netsize);radpower=new Int32Array(netsize>>3);var i,v;for(i=0;i<netsize;i++){v=(i<<netbiasshift+8)/netsize;network[i]=new Float64Array([v,v,v,0]);freq[i]=intbias/netsize;bias[i]=0}}function unbiasnet(){for(var i=0;i<netsize;i++){network[i][0]>>=netbiasshift;network[i][1]>>=netbiasshift;network[i][2]>>=netbiasshift;network[i][3]=i}}function altersingle(alpha,i,b,g,r){network[i][0]-=alpha*(network[i][0]-b)/initalpha;network[i][1]-=alpha*(network[i][1]-g)/initalpha;network[i][2]-=alpha*(network[i][2]-r)/initalpha}function alterneigh(radius,i,b,g,r){var lo=Math.abs(i-radius);var hi=Math.min(i+radius,netsize);var j=i+1;var k=i-1;var m=1;var p,a;while(j<hi||k>lo){a=radpower[m++];if(j<hi){p=network[j++];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}if(k>lo){p=network[k--];p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}}}function contest(b,g,r){var bestd=~(1<<31);var bestbiasd=bestd;var bestpos=-1;var bestbiaspos=bestpos;var i,n,dist,biasdist,betafreq;for(i=0;i<netsize;i++){n=network[i];dist=Math.abs(n[0]-b)+Math.abs(n[1]-g)+Math.abs(n[2]-r);if(dist<bestd){bestd=dist;bestpos=i}biasdist=dist-(bias[i]>>intbiasshift-netbiasshift);if(biasdist<bestbiasd){bestbiasd=biasdist;bestbiaspos=i}betafreq=freq[i]>>betashift;freq[i]-=betafreq;bias[i]+=betafreq<<gammashift}freq[bestpos]+=beta;bias[bestpos]-=betagamma;return bestbiaspos}function inxbuild(){var i,j,p,q,smallpos,smallval,previouscol=0,startpos=0;for(i=0;i<netsize;i++){p=network[i];smallpos=i;smallval=p[1];for(j=i+1;j<netsize;j++){q=network[j];if(q[1]<smallval){smallpos=j;smallval=q[1]}}q=network[smallpos];if(i!=smallpos){j=q[0];q[0]=p[0];p[0]=j;j=q[1];q[1]=p[1];p[1]=j;j=q[2];q[2]=p[2];p[2]=j;j=q[3];q[3]=p[3];p[3]=j}if(smallval!=previouscol){netindex[previouscol]=startpos+i>>1;for(j=previouscol+1;j<smallval;j++)netindex[j]=i;previouscol=smallval;startpos=i}}netindex[previouscol]=startpos+maxnetpos>>1;for(j=previouscol+1;j<256;j++)netindex[j]=maxnetpos}function inxsearch(b,g,r){var a,p,dist;var bestd=1e3;var best=-1;var i=netindex[g];var j=i-1;while(i<netsize||j>=0){if(i<netsize){p=network[i];dist=p[1]-g;if(dist>=bestd)i=netsize;else{i++;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}if(j>=0){p=network[j];dist=g-p[1];if(dist>=bestd)j=-1;else{j--;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}}return best}function learn(){var i;var lengthcount=pixels.length;var alphadec=30+(samplefac-1)/3;var samplepixels=lengthcount/(3*samplefac);var delta=~~(samplepixels/ncycles);var alpha=initalpha;var radius=initradius;var rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(i=0;i<rad;i++)radpower[i]=alpha*((rad*rad-i*i)*radbias/(rad*rad));var step;if(lengthcount<minpicturebytes){samplefac=1;step=3}else if(lengthcount%prime1!==0){step=3*prime1}else if(lengthcount%prime2!==0){step=3*prime2}else if(lengthcount%prime3!==0){step=3*prime3}else{step=3*prime4}var b,g,r,j;var pix=0;i=0;while(i<samplepixels){b=(pixels[pix]&255)<<netbiasshift;g=(pixels[pix+1]&255)<<netbiasshift;r=(pixels[pix+2]&255)<<netbiasshift;j=contest(b,g,r);altersingle(alpha,j,b,g,r);if(rad!==0)alterneigh(rad,j,b,g,r);pix+=step;if(pix>=lengthcount)pix-=lengthcount;i++;if(delta===0)delta=1;if(i%delta===0){alpha-=alpha/alphadec;radius-=radius/radiusdec;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(j=0;j<rad;j++)radpower[j]=alpha*((rad*rad-j*j)*radbias/(rad*rad))}}}function buildColormap(){init();learn();unbiasnet();inxbuild()}this.buildColormap=buildColormap;function getColormap(){var map=[];var index=[];for(var i=0;i<netsize;i++)index[network[i][3]]=i;var k=0;for(var l=0;l<netsize;l++){var j=index[l];map[k++]=network[j][0];map[k++]=network[j][1];map[k++]=network[j][2]}return map}this.getColormap=getColormap;this.lookupRGB=inxsearch}module.exports=NeuQuant},{}],4:[function(require,module,exports){var GIFEncoder,renderFrame;GIFEncoder=require("./GIFEncoder.js");renderFrame=function(frame){var encoder,page,stream,transfer;encoder=new GIFEncoder(frame.width,frame.height);if(frame.index===0){encoder.writeHeader()}else{encoder.firstFrame=false}encoder.setTransparent(frame.transparent);encoder.setRepeat(frame.repeat);encoder.setDelay(frame.delay);encoder.setQuality(frame.quality);encoder.setDither(frame.dither);encoder.setGlobalPalette(frame.globalPalette);encoder.addFrame(frame.data);if(frame.last){encoder.finish()}if(frame.globalPalette===true){frame.globalPalette=encoder.getGlobalPalette()}stream=encoder.stream();frame.data=stream.pages;frame.cursor=stream.cursor;frame.pageSize=stream.constructor.pageSize;if(frame.canTransfer){transfer=function(){var i,len,ref,results;ref=frame.data;results=[];for(i=0,len=ref.length;i<len;i++){page=ref[i];results.push(page.buffer)}return results}();return self.postMessage(frame,transfer)}else{return self.postMessage(frame)}};self.onmessage=function(event){return renderFrame(event.data)}},{"./GIFEncoder.js":1}]},{},[4]);\n';var GLU={},gl;
(function(){this.setupGL=function(a){this.canvas=a;try{var c=this.canvas.getContext("webgl2",{preserveDrawingBuffer:!0,antialias:!0})}catch(k){this.fail(k.message+". This can't run in your browser.")}c||this.fail("Could not initialise WebGL");b=this.gl=c;0<=b.getSupportedExtensions().indexOf("EXT_frag_depth")&&((this.depthExt=b.getExtension("EXT_frag_depth"))||this.fail("Your platform does not support EXT_frag_depth"));0<=b.getSupportedExtensions().indexOf("EXT_color_buffer_float")&&((this.floatBufExt=
b.getExtension("EXT_color_buffer_float"))||this.fail("Your platform does not support EXT_color_buffer_float"));0<=b.getSupportedExtensions().indexOf("OES_texture_float_linear")&&((this.floatLinExt=b.getExtension("OES_texture_float_linear"))||this.fail("Your platform does not support OES_texture_float_linear"))};this.glTypeSize=function(a){switch(a){case b.BYTE:case b.UNSIGNED_BYTE:return 1;case b.SHORT:case b.UNSIGNED_SHORT:return 2;case b.INT:case b.UNSIGNED_INT:case b.FLOAT:return 4;default:return 0}};
this.resolveShaderSource=function(a){for(var b={},c=0;c<a.length;c++){var f=a[c];b[f]={v:Shaders[f+"-vertex-shader"],f:Shaders[f+"-fragment-shader"]}}return b};this.createProgram=function(a,c){var d=b.createProgram();b.attachShader(d,a);b.attachShader(d,c);b.linkProgram(d);b.getProgramParameter(d,b.LINK_STATUS)||(console.log(b.getProgramInfoLog(d)),console.log(b.getShaderInfoLog(c)),console.log(b.getShaderInfoLog(a)),d=null);return d};this.compileShaderSource=function(a,c,e){var d=b.createShader(e);
b.shaderSource(d,c);b.compileShader(d);return b.getShaderParameter(d,b.COMPILE_STATUS)?d:(console.log(a+" "+(e==b.VERTEX_SHADER?"vertex":"fragment")+": "+b.getShaderInfoLog(d)),null)};this.Shader=function(a,c,e){shaderSource=c[a];vertSource=(" "+shaderSource.v).slice(1);fragSource=(" "+shaderSource.f).slice(1);if(null!=e)for(var d in e)e.hasOwnProperty(d)&&(vertSource=vertSource.replace(new RegExp(d,"g"),e[d]),fragSource=fragSource.replace(new RegExp(d,"g"),e[d]));c=GLU.compileShaderSource(a,vertSource,
b.VERTEX_SHADER);a=GLU.compileShaderSource(a,fragSource,b.FRAGMENT_SHADER);this.program=null;c&&a&&(this.program=GLU.createProgram(c,a));this.program&&!b.getProgramParameter(this.program,b.LINK_STATUS)&&(console.log("failed to link: "+b.getProgramInfoLog(this.program)),this.program=null);this.uniforms={}};this.Shader.prototype.bind=function(){b.useProgram(this.program)};this.Shader.prototype.getProgram=function(){return this.program};this.Shader.prototype.getAttribLocation=function(a){return b.getAttribLocation(this.program,
a)};this.Shader.prototype.getUniformLocation=function(a){return b.getUniformLocation(this.program,a)};this.Shader.prototype.uniformIndex=function(a){a in this.uniforms||(this.uniforms[a]=b.getUniformLocation(this.program,a));return this.uniforms[a]};this.Shader.prototype.uniformTexture=function(a,c){a=this.uniformIndex(a);-1!=a&&b.uniform1i(a,c.boundUnit)};this.Shader.prototype.uniformI=function(a,c){a=this.uniformIndex(a);-1!=a&&b.uniform1i(a,c)};this.Shader.prototype.uniformF=function(a,c){a=this.uniformIndex(a);
-1!=a&&b.uniform1f(a,c)};this.Shader.prototype.uniform2F=function(a,c,e){a=this.uniformIndex(a);-1!=a&&b.uniform2f(a,c,e)};this.Shader.prototype.uniform1Fv=function(a,c){a=this.uniformIndex(a);-1!=a&&b.uniform1fv(a,c)};this.Shader.prototype.uniform2Fv=function(a,c){a=this.uniformIndex(a);-1!=a&&b.uniform2fv(a,c)};this.Shader.prototype.uniform3F=function(a,c,e,h){a=this.uniformIndex(a);-1!=a&&b.uniform3f(a,c,e,h)};this.Shader.prototype.uniform3Fv=function(a,c){a=this.uniformIndex(a);-1!=a&&b.uniform3fv(a,
c)};this.Shader.prototype.uniform4F=function(a,c,e,h,l){a=this.uniformIndex(a);-1!=a&&b.uniform4F(a,c,e,h,l)};this.Shader.prototype.uniform4Fv=function(a,c){a=this.uniformIndex(a);-1!=a&&b.uniform4fv(a,c)};this.Shader.prototype.uniformMatrix4fv=function(a,c){a=this.uniformIndex(a);-1!=a&&b.uniformMatrix4fv(a,!1,c)};this.VertexBuffer=function(){this.attributes=[];this.elementSize=0};this.VertexBuffer.prototype.bind=function(){b.bindBuffer(b.ARRAY_BUFFER,this.glName)};this.VertexBuffer.prototype.addAttribute=
function(a,b,c,e){this.attributes.push({name:a,size:b,type:c,norm:e,offset:this.elementSize,index:-1});this.elementSize+=b*GLU.glTypeSize(c)};this.VertexBuffer.prototype.init=function(a){this.length=a;this.glName=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.glName);b.bufferData(b.ARRAY_BUFFER,this.length*this.elementSize,b.STATIC_DRAW)};this.VertexBuffer.prototype.copy=function(a){if(a.byteLength!=this.length*this.elementSize)throw Error("Resizing VBO during copy strongly discouraged");b.bufferData(b.ARRAY_BUFFER,
a,b.STATIC_DRAW)};this.VertexBuffer.prototype.draw=function(a,c,e){for(var d=0;d<this.attributes.length;++d)if(this.attributes[d].index=b.getAttribLocation(a.program,this.attributes[d].name),0<=this.attributes[d].index){var f=this.attributes[d];b.enableVertexAttribArray(f.index);b.vertexAttribPointer(f.index,f.size,f.type,f.norm,this.elementSize,f.offset)}b.drawArrays(c,0,e?e:this.length);for(d=0;d<this.attributes.length;++d)0<=this.attributes[d].index&&(b.disableVertexAttribArray(this.attributes[d].index),
this.attributes[d].index=-1)};this.Texture=function(a,c,e,h,l,n,p){this.width=a;this.height=c;this.coordMode=n?b.CLAMP_TO_EDGE:b.REPEAT;this.type=h?b.FLOAT:b.UNSIGNED_BYTE;this.internalformat=[b.R32F,b.RG32F,b.RGB32F,b.RGBA32F][e-1];this.format=[b.RED,b.RG,b.RGB,b.RGBA][e-1];this.interpMode=l?b.LINEAR:b.NEAREST;this.glName=b.createTexture();b.bindTexture(b.TEXTURE_2D,this.glName);b.texImage2D(b.TEXTURE_2D,0,this.internalformat,this.width,this.height,0,this.format,this.type,p);this.setFilter();this.boundUnit=
-1};this.Texture.prototype.copy=function(a){b.texImage2D(b.TEXTURE_2D,0,this.internalformat,this.width,this.height,0,this.format,this.type,a);null!==a&&this.setFilter()};this.Texture.prototype.setFilter=function(){b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,this.coordMode);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,this.coordMode);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.interpMode);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,this.interpMode)};this.Texture.prototype.bind=
function(a){b.activeTexture(b.TEXTURE0+a);b.bindTexture(b.TEXTURE_2D,this.glName);this.boundUnit=a};this.loadImageAndCreateTextureInfo=function(a,c){var d=b.createTexture();b.bindTexture(b.TEXTURE_2D,d);b.texImage2D(b.TEXTURE_2D,0,b.SRGB8,1,1,0,b.RGB,b.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));var e={width:1,height:1,texture:d,url:a},f=new Image;f.addEventListener("load",function(){e.width=f.width;e.height=f.height;e.url=a;e.tex=d;b.bindTexture(b.TEXTURE_2D,d);b.texImage2D(b.TEXTURE_2D,0,b.SRGB8,
b.RGB,b.UNSIGNED_BYTE,f);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);c(e)});f.crossOrigin="";f.src=a;return e};this.RenderTarget=function(){this.glName=b.createFramebuffer()};this.RenderTarget.prototype.bind=function(){b.bindFramebuffer(b.FRAMEBUFFER,this.glName)};this.RenderTarget.prototype.unbind=function(){b.bindFramebuffer(b.FRAMEBUFFER,null)};this.RenderTarget.prototype.delete=
function(){b.deleteFramebuffer(this.glName)};this.RenderTarget.prototype.attachTexture=function(a,c){b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0+c,b.TEXTURE_2D,a.glName,0)};this.RenderTarget.prototype.detachTexture=function(a){b.framebufferTexture2D(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0+a,b.TEXTURE_2D,null,0)};this.RenderTarget.prototype.drawBuffers=function(a){for(var c=[],e=0;e<a;++e)c.push(b.COLOR_ATTACHMENT0+e);b.drawBuffers(c)};this.fail=function(a){var b=document.createElement("p");
b.appendChild(document.createTextNode("[Party] error occurred:"));b.style.fontSize="32px";b.style.color="red";var c=document.createElement("p");c.className="warning-box";c.style.fontSize="24px";c.innerHTML="<pre>    "+a+"</pre>";a=document.createElement("div");a.className="center";a.appendChild(b);a.appendChild(c);document.getElementById("container").appendChild(a);this.canvas.style.display="none";gravy.terminated=!0;throw Error("Terminating Party");};var a=document.createElement("style");a.appendChild(document.createTextNode(""));
document.head.appendChild(a);a=window.document.styleSheets[0];a.insertRule("body{\n        margin: 0px;\n        overflow: hidden;\n        }",a.cssRules.length);a.insertRule("#container {\n        position: relative;\n        margin: 0px;\n        padding: 0px;\n    }",a.cssRules.length);a.insertRule("#textContainer {\n        position: absolute;\n        margin: 0px;\n        overflow: hidden;\n        left: 0px;\n        top: 0px;\n        pointer-events: none;\n        z-index: 1;\n    }",a.cssRules.length);
a.insertRule("#gui {\n        position: absolute;\n        z-index: 100;\n        right: 0px;\n    }",a.cssRules.length);var c=document.createElement("div");c.id="container";document.body.appendChild(c);a=document.createElement("canvas");a.id="render-canvas";a.width=window.innerWidth;a.height=window.innerHeight;c.appendChild(a);var e=document.createElement("div");e.id="textContainer";c.appendChild(e);c=document.createElement("canvas");c.id="text-canvas";e.appendChild(c);try{this.setupGL(a)}catch(f){this.fail(f.message+
". This can't run in your browser.");return}var b=this.gl}).apply(GLU);var GUI=function(a){a=void 0===a?!0:a;this.gui=new dat.GUI;this.gui.domElement.id="gui";this.visible=a;this.createUserSettings();this.createEngineSettings();this.createRendererSettings();a||this.gui.__proto__.constructor.toggleHide()};function updateDisplay(a){for(var c in a.__controllers)a.__controllers[c].updateDisplay();for(var e in a.__folders)updateDisplay(a.__folders[e])}GUI.prototype.sync=function(){updateDisplay(this.gui)};GUI.prototype.toggleHide=function(){this.visible=!this.visible};
function hexToRgb(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}GUI.prototype.createUserSettings=function(){var a=party.getParticleSystem();"undefined"!==typeof a.init_gui&&(this.userFolder=this.gui.addFolder("User settings"),a.init_gui(this),this.userFolder.open())};
GUI.prototype.createEngineSettings=function(){this.engineFolder=this.gui.addFolder("Engine");var a=party.getEngine();this.engineFolder.add(a.settings,"NparticlesSqrt",1,1E4).onChange(function(c){a.resize(Math.floor(c))});this.engineFolder.add(a.settings,"timestep",0,1).onChange(function(){a.restart()});this.engineFolder.add(a.settings,"lifetime",0,100).onChange(function(){a.restart()});this.engineFolder.add(a.settings,"max_timesteps",10,1E4).onChange(function(c){a.settings.max_timesteps=Math.floor(c);
a.restart()});this.engineFolder.open()};
GUI.prototype.createRendererSettings=function(){this.rendererFolder=this.gui.addFolder("Raytracer");var a=party.getRenderer();this.rendererFolder.add(a.settings,"exposure",-10,10).onChange(function(){party.render_dirty()});this.rendererFolder.add(a.settings,"gamma",0,3).onChange(function(){party.render_dirty()});this.rendererFolder.add(a.settings,"saturation",0,3).onChange(function(){party.render_dirty()});this.rendererFolder.add(a.settings,"radius",0,100).onChange(function(){party.render_dirty()});this.rendererFolder.open()};
GUI.prototype.addSlider=function(a,c,e){var b=this.userFolder;"undefined"!==typeof e&&(b=e);e=c.name;var f=c.min,d=c.max;c=c.step;a=null==c||void 0==c?b.add(a,e,f,d,c):b.add(a,e,f,d);a.onChange(function(a){party.reset();party.camera.enabled=!1});a.onFinishChange(function(a){party.camera.enabled=!0});return a};
GUI.prototype.addColor=function(a,c,e,b){e=void 0===e?1:e;var f=this.userFolder;"undefined"!==typeof b&&(f=b);f[c]=[255*a[c][0],255*a[c][1],255*a[c][2]];b=f.addColor(f,c);b.onChange(function(b){"string"===typeof b||b instanceof String?(b=hexToRgb(b),a[c][0]=e*b.r/255,a[c][1]=e*b.g/255,a[c][2]=e*b.b/255):(a[c][0]=e*b[0]/255,a[c][1]=e*b[1]/255,a[c][2]=e*b[2]/255);party.reset()});return b};GUI.prototype.addParameter=function(a,c){this.addSlider(a,c)};GUI.prototype.getGUI=function(){return this.gui};
GUI.prototype.getUserFolder=function(){return this.userFolder};var Shaders={"initialize-fragment-shader":'#version 300 es\nprecision highp float;\n\n\n/////// output buffers ///////\nlayout(location = 0) out vec4 position_output;\nlayout(location = 1) out vec4 velocity_output;\nlayout(location = 2) out vec4 material_output;\nlayout(location = 3) out vec4 rng_output;\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\n// From https://github.com/ashima/webgl-noise/blob/master/src/noise2D.glsl\n// ("Array and textureless GLSL 2D simplex noise function", Ian McEwan, Ashima Arts)\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n  // First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n  // Other corners\n  vec2 i1;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n  // Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n  // Gradients: 41 points uniformly over a line, mapped onto a diamond.\n  // The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n  // Normalise gradients implicitly by scaling m\n  // Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n  // Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\n// Float hashes, from https://www.shadertoy.com/view/4dS3Wd\nfloat hash(float n) { return fract(sin(n) * 1e4); }\nfloat hash(vec2 p) { return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x)))); }\n\n// Integer Hash, from https://www.shadertoy.com/view/WttXWX\nuint triple32(uint x)\n{\n    x ^= x >> 17;\n    x *= 0xed5ad4bbU;\n    x ^= x >> 11;\n    x *= 0xac4c1b51U;\n    x ^= x >> 15;\n    x *= 0x31848babU;\n    x ^= x >> 14;\n    return x;\n}\n#define hashi(x)  (float(triple32(x)) / float(0xffffffffU))\n\n\nvoid main()\n{\n    // fragments range over [N, N] space\n    uvec2 frag = uvec2(gl_FragCoord.xy);\n\n    // initialize the particle position\n    vec3 birth_position = vec3(1.0e6); // dummy offscreen particle coordinate\n\n    // initialize the particle birth phase\n    float birth_phase = hashi(frag.x + triple32(frag.y));\n\n    position_output = vec4(birth_position, birth_phase);\n    velocity_output = vec4(0.0);\n    material_output = vec4(0.0);\n\n    vec4 seed = vec4(hash(gl_FragCoord.x), hash(gl_FragCoord.y), hash(birth_phase), 1.0);\n    rng_output = seed;\n}\n',
"initialize-vertex-shader":"#version 300 es\nprecision highp float;\n\nin vec3 Position;\nin vec2 TexCoord;\n\nvoid main() \n{\n    gl_Position = vec4(Position, 1.0);\n}\n","render-fragment-shader":"#version 300 es\nprecision highp float;\n\nuniform float exposure;\nuniform float invGamma;\nuniform float saturation;\n\nin vec3 pColor;\nout vec4 outColor;\n\n\nfloat tonemapReinhard(float x)\n{\n  return x / (1.0 + x);\n}\n\nfloat tonemapFilmic(float x)\n{\n  float X = max(0.0, x - 0.004);\n  float result = (X * (6.2 * X + 0.5)) / (X * (6.2 * X + 1.7) + 0.06);\n  return pow(result, 2.2);\n}\n\nvec3 post(in vec3 C)\n{\n    // apply gamma correction to convert linear RGB to sRGB\n    C = pow(C, vec3(invGamma));\n\n    // deal with out-of-gamut RGB.\n    float delta = -min(0.0, min(min(C.r, C.g), C.b));\n    C.r += delta;\n    C.g += delta;\n    C.b += delta;\n\n    // apply tonemapping\n    C *= pow(2.0, exposure);\n    float R = C.r;\n    float G = C.g;\n    float B = C.b;\n    R = tonemapFilmic(R);\n    G = tonemapFilmic(G);\n    B = tonemapFilmic(B);\n\n    // apply saturation\n    float mean = (R + G + B)/3.0;\n    float dR = R - mean;\n    float dG = G - mean;\n    float dB = B - mean;\n    R = mean + sign(dR)*pow(abs(dR), 1.0/saturation);\n    G = mean + sign(dG)*pow(abs(dG), 1.0/saturation);\n    B = mean + sign(dB)*pow(abs(dB), 1.0/saturation);\n\n    return vec3(R,G,B);\n}\n\n\nvoid main()\n{\n    vec2 uv = 2.0*gl_PointCoord-1.0;\n    float r = length(uv);\n    float alpha = smoothstep(1.0, 0.0, r);\n    outColor.rgb = post(pColor) * alpha;\n    outColor.a = alpha;\n}\n",
"render-vertex-shader":"#version 300 es\nprecision highp float;\n\nuniform sampler2D position_sampler; // 0, particle position\nuniform sampler2D velocity_sampler; // 1, particle velocity\nuniform sampler2D material_sampler; // 2, particle material\nuniform sampler2D rng_sampler;      // 3, particle rng seeds\n// (User textures start at index 4)\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelViewMatrix;\nuniform int NparticlesSqrt;\nuniform float radius;\nuniform float t;\nuniform float lifetime;\nuniform float timestep;\n\nout vec3 pColor; // color, for fragment shader\n\nfloat rand(inout vec4 rnd)\n{\n    const vec4 q = vec4(   1225.0,    1585.0,    2457.0,    2098.0);\n    const vec4 r = vec4(   1112.0,     367.0,      92.0,     265.0);\n    const vec4 a = vec4(   3423.0,    2646.0,    1707.0,    1999.0);\n    const vec4 m = vec4(4194287.0, 4194277.0, 4194191.0, 4194167.0);\n    vec4 beta = floor(rnd/q);\n    vec4 p = a*(rnd - beta*q) - beta*r;\n    beta = (1.0 - sign(p))*0.5*m;\n    rnd = p + beta;\n    return fract(dot(rnd/m, vec4(1.0, -1.0, 1.0, -1.0)));\n}\n\n/////////////////////// user-defined code ///////////////////////\n_USER_CODE_\n/////////////////////// user-defined code ///////////////////////\n\n\nvoid main()\n{\n    // Obtain particle position from position_sampler, generated by engine\n    int id = gl_VertexID;\n    int N = NparticlesSqrt;\n    int row = id % N;\n    int col = id / N;\n    ivec2 frag = ivec2(row, col);\n\n    vec4 P = texelFetch(position_sampler, frag, 0);\n    vec3 V = texelFetch(velocity_sampler, frag, 0).xyz;\n    vec4 M = texelFetch(material_sampler, frag, 0);\n\n    vec3 position = P.xyz;\n    float birth_phase = P.w; // in [0,1]\n\n    // Compute particle age, i.e time elapsed since birth\n    float global_phase = mod(t, lifetime)/ lifetime; // in [0,1]\n    float dphase = global_phase - birth_phase;\n    if (dphase < 0.0) dphase += 1.0; // or, dp += 1.0 - step(0, dp)\n    float age = lifetime * dphase;\n\n    // Compute particle color via user-specified function\n    pColor = COLOR(position, V, M, t, age, lifetime, id, N*N);\n\n    gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = radius;\n}\n",
"update-fragment-shader":'#version 300 es\nprecision highp float;\n\nuniform float t;\nuniform float lifetime;\nuniform float dt; // timestep\nuniform int NparticlesSqrt;\n\nuniform sampler2D position_sampler; // 0, particle position\nuniform sampler2D velocity_sampler; // 1, particle velocity\nuniform sampler2D material_sampler; // 2, particle material\nuniform sampler2D rng_sampler;      // 3, particle rng seeds\n// (User textures start at index 4)\n\n/////// output buffers ///////\nlayout(location = 0) out vec4 position_output;\nlayout(location = 1) out vec4 velocity_output;\nlayout(location = 2) out vec4 material_output;\nlayout(location = 3) out vec4 rng_output;\n\nfloat rand(inout vec4 rnd)\n{\n    const vec4 q = vec4(   1225.0,    1585.0,    2457.0,    2098.0);\n    const vec4 r = vec4(   1112.0,     367.0,      92.0,     265.0);\n    const vec4 a = vec4(   3423.0,    2646.0,    1707.0,    1999.0);\n    const vec4 m = vec4(4194287.0, 4194277.0, 4194191.0, 4194167.0);\n    vec4 beta = floor(rnd/q);\n    vec4 p = a*(rnd - beta*q) - beta*r;\n    beta = (1.0 - sign(p))*0.5*m;\n    rnd = p + beta;\n    return fract(dot(rnd/m, vec4(1.0, -1.0, 1.0, -1.0)));\n}\n\n/////////////////////// user-defined code ///////////////////////\n_USER_CODE_\n/////////////////////// user-defined code ///////////////////////\n\n\n/*\n    - time is broken into specified emission lifetime\n    - there are a fixed total number N of particles\n    - each particle is given a random birth "phase" p_birth (in [0,1]) within the lifetime\n    - any given time t maps to a global phase p(t) = mod(t, lifetime)/lifetime\n    - thus we know at any given time the age of each particle, i.e. lifetime*dp, where dp = (p(t) - p_birth) % 1\n\n        float dp = p - p_birth\n        if (dp<0) dp += 1.0; // or, dp += 1.0 - step(0, dp)\n        float age = lifetime*dp;\n\n    - time advances in specified timesteps dt, corresponding to phase shift dt/lifetime\n\n    - particle positions are initialized to some dummy value ("offscreen")\n\n    - at the beginning of each timestep, we run emission logic:\n            - if particle age < dt, this particle is considered stale and re-emitted in this timestep\n            - randomly sample an emission location for this particle and reset its position to that\n            - (otherwise, don\'t alter the particle location)\n\n    - in "continuous emission" mode, this emission process is run every timestep\n        (and if the force is time-independent, the system settles into a steady state)\n\n    - in "burst emission" mode, the emission is done only in the first lifetime,\n        thereafter the particles just advect and are never re-emitted.\n        (equivalent to infinite lifetime)\n\n    - on each timestep, after the emission logic we:\n            - advect each particle position in an arbitrary specified (force field),\n                in general time-dependent\n            - render each particle, where the rendered particle vec3 emission is an arbitrary\n                function of particle "id", position, time, and birth time\n\n    - e.g.:  N = 1000000, dt=1/25, lifetime=4  (=> 100 frames per lifetime)\n    -        in each timestep, about N/100 = 10000 particles are re-emitted\n*/\n\nvoid main()\n{\n    ivec2 frag = ivec2(gl_FragCoord.xy);\n\n    vec4 P     = texelFetch(position_sampler, frag, 0);     // current position\n    vec3 V     = texelFetch(velocity_sampler, frag, 0).xyz; // current velocity\n    vec4 M     = texelFetch(material_sampler, frag, 0);     // current material\n    vec4 seed  = texelFetch(rng_sampler, frag, 0);          // current RNG seed\n\n    vec3 X = P.xyz;\n    float birth_phase = P.w; // in [0,1]\n\n    // Compute particle age, i.e time elapsed since last re-birth\n    float global_phase = mod(t, lifetime) / lifetime; // in [0,1]\n    float dphase = global_phase - birth_phase; // current relative phase of particle birth time and global time\n    bool born = (t>lifetime) || (dphase>0.0);\n    if (born)\n    {\n        dphase = mod(dphase, 1.0);\n        float age = lifetime * dphase;\n        float h = dt;\n        if (age < dt)\n        {\n            // re-emit particle\n            int particle_id = frag.x + frag.y*NparticlesSqrt;\n            int Nparticles = NparticlesSqrt*NparticlesSqrt;\n            EMIT(seed, t, birth_phase, lifetime, particle_id, Nparticles, // inputs\n                 X, V, M);                                                // emitted position (X), velocity (V), and material (M)\n            h = age;\n        }\n        UPDATE(X, V, M, t, h); // update position (X), velocity (V), and material (M)\n    }\n\n    position_output.xyz = X;\n    position_output.w   = birth_phase;\n    velocity_output.xyz = V;\n    material_output     = M;\n    rng_output      = seed;\n}\n',
"update-vertex-shader":"#version 300 es\nprecision highp float;\n\nin vec3 Position;\nin vec2 TexCoord;\n\nvoid main()\n{\n    gl_Position = vec4(Position, 1.0);\n}\n"};var Renderer=function(){this.settings={};this.settings.exposure=0;this.settings.gamma=2.2;this.settings.saturation=1;this.settings.radius=1;this.quadVbo=this.createQuadVbo();this.pointsVbo=null;this.pointsCount=0;this.fbo=new GLU.RenderTarget;this.shaderSources=GLU.resolveShaderSource(["render"]);this.compileShaders()};
Renderer.prototype.createQuadVbo=function(){var a=GLU.gl,c=new GLU.VertexBuffer;c.addAttribute("Position",3,a.FLOAT,!1);c.addAttribute("TexCoord",2,a.FLOAT,!1);c.init(4);c.copy(new Float32Array([1,1,0,1,1,-1,1,0,0,1,-1,-1,0,0,0,1,-1,0,1,0]));return c};
Renderer.prototype.compileShaders=function(){this.compiled_successfully=!1;var a=party.getShader();replacements={};replacements._USER_CODE_="\n"+a+"\n";this.render_program=new GLU.Shader("render",this.shaderSources,replacements);this.render_program.program?this.compiled_successfully=!0:this.render_program=null};Renderer.prototype.reset=function(){var a=GLU.gl;a.clearColor(0,0,0,1);this.fbo.bind();this.fbo.drawBuffers(1);this.fbo.attachTexture(this.radianceBuffer,0);a.clear(a.COLOR_BUFFER_BIT);this.fbo.unbind()};
Renderer.prototype.render=function(){var a=GLU.gl;a.viewport(0,0,this.width,this.height);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.disable(a.DEPTH_TEST);var c=party.getEngine();this.render_program.bind();var e=party.getCamera(),b=e.projectionMatrix.toArray(),f=this.render_program.getUniformLocation("u_projectionMatrix");a.uniformMatrix4fv(f,!1,b);e.updateMatrixWorld();b=new THREE.Matrix4;b.getInverse(e.matrixWorld);e=b.toArray();b=this.render_program.getUniformLocation("u_modelViewMatrix");
a.uniformMatrix4fv(b,!1,e);e=party.getParticleSystem();"undefined"!==typeof e.sync_shader&&e.sync_shader(party,this.render_program);e=c.get_particle_positions();b=c.get_particle_velocities();f=c.get_particle_materials();e.bind(0);b.bind(1);f.bind(2);this.render_program.uniformTexture("position_sampler",e);this.render_program.uniformTexture("velocity_sampler",b);this.render_program.uniformTexture("material_sampler",f);this.render_program.uniformI("NparticlesSqrt",c.settings.NparticlesSqrt);this.render_program.uniformF("radius",
this.settings.radius);this.render_program.uniformF("t",c.time);this.render_program.uniformF("lifetime",c.settings.lifetime);this.render_program.uniformF("timestep",c.settings.timestep);this.render_program.uniformF("exposure",this.settings.exposure);this.render_program.uniformF("invGamma",1/this.settings.gamma);this.render_program.uniformF("saturation",this.settings.saturation);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE);a.enable(a.BLEND);a.drawArrays(a.POINTS,0,c.settings.Nparticles);a.disable(a.BLEND);
a.finish()};Renderer.prototype.resize=function(a,c){this.width=a;this.height=c;this.radianceBuffer=new GLU.Texture(a,c,4,!0,!1,!0,null)};var Engine=function(){this.settings={};this.settings.NparticlesSqrt=100;this.settings.timestep=1/24;this.settings.lifetime=5;this.settings.max_timesteps=1E3;var a=GLU.gl,a=a.getParameter(a.MAX_TEXTURE_SIZE);this.NparticlesSqrt>a&&(console.error("Particle count "+this.NparticlesSqrt+" too high. Max is "+a),GLU.fail("Particle count "+this.NparticlesSqrt+" too high. Max is "+a));this.quadVbo=this.createQuadVbo();this.fbo=new GLU.RenderTarget;this.shaderSources=GLU.resolveShaderSource(["initialize","update"]);
this.compileShaders();this.resize(this.settings.NparticlesSqrt);this.restart();this.paused=!1};Engine.prototype.alloc_texture_pair=function(a,c,e,b,f,d,k){return[new GLU.Texture(a,c,e,b,f,d,k),new GLU.Texture(a,c,e,b,f,d,k)]};
Engine.prototype.compileShaders=function(){this.compiled_successfully=!1;var a=party.getShader();replacements={};replacements._USER_CODE_="\n"+a+"\n";this.initialize_program=new GLU.Shader("initialize",this.shaderSources,null);this.initialize_program.program?(this.update_program=new GLU.Shader("update",this.shaderSources,replacements),this.update_program.program?this.compiled_successfully=!0:this.update_program=null):this.initialize_program=null};
Engine.prototype.resize=function(a){a=Math.round(a);1E4<a&&(a=1E4);this.settings.NparticlesSqrt=a;this.settings.Nparticles=a*a;this.particle_positions=this.alloc_texture_pair(a,a,4,!0,!1,!0,null);this.particle_velocities=this.alloc_texture_pair(a,a,4,!0,!1,!0,null);this.particle_materials=this.alloc_texture_pair(a,a,4,!0,!1,!0,null);this.particle_rngs=this.alloc_texture_pair(a,a,4,!0,!1,!0,null);this.restart()};
Engine.prototype.createQuadVbo=function(){var a=GLU.gl,c=new GLU.VertexBuffer;c.addAttribute("Position",3,a.FLOAT,!1);c.addAttribute("TexCoord",2,a.FLOAT,!1);c.init(4);c.copy(new Float32Array([1,1,0,1,1,-1,1,0,0,1,-1,-1,0,0,0,1,-1,0,1,0]));return c};Engine.prototype.restart=function(){this.time=this.frame=0};Engine.prototype.get_frame=function(){return this.frame};Engine.prototype.get_timestep=function(){return this.settings.timestep};Engine.prototype.pauseToggle=function(){this.paused=!this.paused};
Engine.prototype.pause=function(){this.paused=!0};Engine.prototype.play=function(){this.paused=!1};
Engine.prototype.step=function(){if(this.compiled_successfully&&!this.paused){this.frame>=this.settings.max_timesteps&&this.restart();var a=party.getParticleSystem(),c=GLU.gl;c.viewport(0,0,this.settings.NparticlesSqrt,this.settings.NparticlesSqrt);this.quadVbo.bind();var e=this.frame%2,b=1-e;0==this.frame&&(this.initialize_program.bind(),this.fbo.bind(),this.fbo.drawBuffers(4),this.fbo.attachTexture(this.particle_positions[e],0),this.fbo.attachTexture(this.particle_velocities[e],1),this.fbo.attachTexture(this.particle_materials[e],
2),this.fbo.attachTexture(this.particle_rngs[e],3),this.quadVbo.draw(this.initialize_program,c.TRIANGLE_FAN),this.fbo.detachTexture(0),this.fbo.detachTexture(1),this.fbo.detachTexture(2),this.fbo.detachTexture(3),this.fbo.unbind());this.update_program.bind();this.update_program.uniformF("t",this.time);this.update_program.uniformF("lifetime",this.settings.lifetime);this.update_program.uniformF("dt",this.settings.timestep);this.update_program.uniformI("NparticlesSqrt",this.settings.NparticlesSqrt);
"undefined"!==typeof a.sync_shader&&a.sync_shader(party,this.update_program);this.fbo.bind();this.fbo.drawBuffers(4);this.fbo.attachTexture(this.particle_positions[b],0);this.fbo.attachTexture(this.particle_velocities[b],1);this.fbo.attachTexture(this.particle_materials[b],2);this.fbo.attachTexture(this.particle_rngs[b],3);this.particle_positions[e].bind(0);this.particle_velocities[e].bind(1);this.particle_materials[e].bind(2);this.particle_rngs[e].bind(3);this.update_program.uniformTexture("position_sampler",
this.particle_positions[e]);this.update_program.uniformTexture("velocity_sampler",this.particle_velocities[e]);this.update_program.uniformTexture("material_sampler",this.particle_materials[e]);this.update_program.uniformTexture("rng_sampler",this.particle_rngs[e]);this.quadVbo.draw(this.update_program,c.TRIANGLE_FAN);this.fbo.detachTexture(0);this.fbo.detachTexture(1);this.fbo.detachTexture(2);this.fbo.detachTexture(3);this.fbo.unbind();c.bindTexture(c.TEXTURE_2D,null);this.frame++;this.time+=this.settings.timestep}};
Engine.prototype.get_particle_positions=function(){return this.particle_positions[0]};Engine.prototype.get_particle_velocities=function(){return this.particle_velocities[0]};Engine.prototype.get_particle_materials=function(){return this.particle_materials[0]};var party,Party=function(a){party=this;this.particle_system=a;this.container=document.getElementById("container");this.render_canvas=a=document.getElementById("render-canvas");this.width=a.width;this.height=a.height;a.style.width=a.width;a.style.height=a.height;this.text_canvas=a=document.getElementById("text-canvas");this.textCtx=a.getContext("2d");window.addEventListener("resize",this,!1);this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,.01,1E4);this.camera.lookAt(new THREE.Vector3(0,
0,0));this.camera.position.set(1,1,1);this.camControls=new THREE.OrbitControls(this.camera,this.container);this.camControls.zoomSpeed=2;this.camControls.flySpeed=.01;this.camControls.addEventListener("change",this.camChanged);this.camControls.keyPanSpeed=100;this.gui=null;this.guiVisible=!0;this.engine=new Engine;this.renderer=new Renderer;null==this.particle_system&&GLU.fail("null particle system object supplied to Party");"undefined"!==typeof this.particle_system.init&&this.particle_system.init(this);
this.resize();this.gui=new GUI(this.guiVisible);window.addEventListener("mousemove",this,!1);window.addEventListener("mousedown",this,!1);window.addEventListener("mouseup",this,!1);window.addEventListener("contextmenu",this,!1);window.addEventListener("click",this,!1);window.addEventListener("keydown",this,!1);this.initialized=!0};Party.prototype.camChanged=function(){};Party.prototype.getVersion=function(){return[1,0,0]};
Party.prototype.handleEvent=function(a){switch(a.type){case "resize":this.resize();break;case "mousemove":this.onDocumentMouseMove(a);break;case "mousedown":this.onDocumentMouseDown(a);break;case "mouseup":this.onDocumentMouseUp(a);break;case "contextmenu":this.onDocumentRightClick(a);break;case "click":this.onClick(a);break;case "keydown":this.onkeydown(a)}};Party.prototype.getRenderer=function(){return this.renderer};Party.prototype.getEngine=function(){return this.engine};
Party.prototype.getGUI=function(){return this.gui};Party.prototype.getCamera=function(){return this.camera};Party.prototype.getControls=function(){return this.camControls};Party.prototype.getGLContext=function(){return GLU.gl};Party.prototype.getShader=function(){"undefined"==typeof this.particle_system.shader&&GLU.fail('Particle system must define a "shader" function');return this.particle_system.shader()};Party.prototype.showGUI=function(a){this.guiVisible=a};Party.prototype.emitter_program=function(){return this.particle_system.emitter_program()};
Party.prototype.force_program=function(){return this.particle_system.force_program()};Party.prototype.getParticleSystem=function(){return this.particle_system};Party.prototype.render_dirty=function(){this.renderer.reset()};Party.prototype.pauseEngineToggle=function(){this.engine.pauseToggle()};Party.prototype.restartEngine=function(){this.engine.restart()};
Party.prototype.step=function(){"undefined"!=typeof this.particle_system.preframe_callback&&this.particle_system.preframe_callback(this);this.paused||(this.engine.step(),this.render_dirty());this.renderer.render();this.update_hud();"undefined"!=typeof this.particle_system.postframe_callback&&this.particle_system.postframe_callback(this)};
Party.prototype.update_hud=function(){if(this.textCtx&&(this.textCtx.textAlign="left",this.textCtx.textBaseline="middle",this.textCtx.font="12px monospace",this.textCtx.clearRect(0,0,this.textCtx.canvas.width,this.textCtx.canvas.height),this.textCtx.globalAlpha=.95,this.textCtx.strokeStyle="black",this.textCtx.lineWidth=2,this.getGUI().visible)){this.textCtx.fillStyle=this.onTrinityLink?"#ff5500":"#ffff00";var a=this.getVersion(),c=this.textCtx.measureText("Party vX.X.X").width,a="Party v"+a[0]+"."+
a[1]+"."+a[2];this.textCtx.strokeText(a,this.textCtx.canvas.width-c-14,this.textCtx.canvas.height-20);this.textCtx.fillText(a,this.textCtx.canvas.width-c-14,this.textCtx.canvas.height-20);this.textCtx.fillStyle="#ffaa22";var c=this.engine.frame,a=this.engine.settings.max_timesteps,e=Number(this.engine.time.toPrecision(3)),c="timestep "+c+"/"+a+", time "+e;this.textCtx.strokeText(c,14,this.textCtx.canvas.height-25);this.textCtx.fillText(c,14,this.textCtx.canvas.height-25);this.textCtx.fillStyle="#ccaaff";
this.textCtx.strokeText("[SPC to pause/play, ESC to restart]",14,this.textCtx.canvas.height-42);this.textCtx.fillText("[SPC to pause/play, ESC to restart]",14,this.textCtx.canvas.height-42)}};Party.prototype.getUserTextureUnitStart=function(){return 4};Party.prototype.reset=function(){this.renderer.reset()};
Party.prototype.resize=function(){var a=window.innerWidth,c=window.innerHeight;this.width=a;this.height=c;var e=this.render_canvas;e.width=a;e.height=c;e.style.width=a;e.style.height=c;e=this.text_canvas;e.width=a;e.height=c;this.camera.aspect=a/c;this.camera.updateProjectionMatrix();this.camControls.update();this.renderer.resize(a,c);this.render_dirty()};
Party.prototype.dumpScene=function(){console.warn("[party] Party.prototype.dumpScene");var a=party.getEngine(),c=party.getRenderer(),e=party.getCamera(),b=party.getControls();var f="\n{\n    /******* copy-pasted console output on 'O', begin *******/\n\n    let engine   = party.getEngine();\n    let renderer = party.getRenderer();\n    let camera   = party.getCamera();\n    let controls = party.getControls();\n";"undefined"!==typeof this.particle_system.initGenerator&&(f+=this.particle_system.initGenerator());
f+=this.guiVisible?"\n    party.showGUI(true);\n":"\nparty.showGUI(false);\n";f+="\n    /** Camera settings **/\n    camera.fov = "+e.fov+";\n    camera.up.set("+e.up.x+", "+e.up.y+", "+e.up.z+");\n    camera.position.set("+e.position.x+", "+e.position.y+", "+e.position.z+");\n    controls.target.set("+b.target.x+", "+b.target.y+", "+b.target.z+");\n\n    /** Engine settings **/\n    let NparticlesSqrt = "+a.settings.NparticlesSqrt+"; engine.resize(NparticlesSqrt);\n    engine.settings.timestep = "+
a.settings.timestep+";\n    engine.settings.lifetime = "+a.settings.lifetime+";\n    engine.settings.max_timesteps = "+a.settings.max_timesteps+";\n\n    /** Renderer settings **/\n    renderer.settings.exposure = "+c.settings.exposure+";\n    renderer.settings.gamma = "+c.settings.gamma+";\n    renderer.settings.saturation = "+c.settings.saturation+";\n    renderer.settings.radius = "+c.settings.radius+";\n";return f+"\n    /******* copy-pasted console output on 'O', end *******/\n}"};
Party.prototype.onClick=function(a){a.preventDefault()};Party.prototype.onDocumentMouseMove=function(a){this.camControls.update()};Party.prototype.onDocumentMouseDown=function(a){this.camControls.update()};Party.prototype.onDocumentMouseUp=function(a){this.camControls.update()};Party.prototype.onDocumentRightClick=function(a){};
Party.prototype.onkeydown=function(a){switch(a.which?a.which:a.keyCode){case 122:a=document.body;"webkitCancelFullScreen"in document?a.webkitRequestFullScreen():"mozCancelFullScreen"in document?a.mozRequestFullScreen():console.assert(!1);break;case 72:this.guiVisible=!this.guiVisible;Party.getGUI().toggleHide();break;case 65:if(!this.camControls.enabled)break;a=new THREE.Vector3;a.copy(this.camControls.target);a.sub(this.camera.position);var c=a.length();a=new THREE.Vector3(1,0,0);var e=a.transformDirection(this.camera.matrix);
a=new THREE.Vector3;a.copy(e);a.multiplyScalar(-this.camControls.flySpeed*c);this.camera.position.add(a);this.camControls.target.add(a);this.reset(!0);break;case 87:if(!this.camControls.enabled)break;e=new THREE.Vector3;e.copy(this.camControls.target);e.sub(this.camera.position);c=e.length();e.normalize();a=new THREE.Vector3;a.copy(e);a.multiplyScalar(this.camControls.flySpeed*c);this.camera.position.add(a);this.camControls.target.add(a);this.reset(!0);break;case 83:if(!this.camControls.enabled)break;
e=new THREE.Vector3;e.copy(this.camControls.target);e.sub(this.camera.position);c=e.length();e.normalize();a=new THREE.Vector3;a.copy(e);a.multiplyScalar(-this.camControls.flySpeed*c);this.camera.position.add(a);this.camControls.target.add(a);this.reset(!0);break;case 68:if(!this.camControls.enabled)break;a=new THREE.Vector3;a.copy(this.camControls.target);a.sub(this.camera.position);c=a.length();a=new THREE.Vector3(1,0,0);e=a.transformDirection(this.camera.matrix);a=new THREE.Vector3;a.copy(e);a.multiplyScalar(this.camControls.flySpeed*
c);this.camera.position.add(a);this.camControls.target.add(a);this.reset(!0);break;case 79:a=this.dumpScene();console.log(a);break;case 32:if(!this.camControls.enabled)break;this.pauseEngineToggle();break;case 27:this.restartEngine()}};
Party.prototype.gif_init=function(a,c){var e=new Blob([gifworker_code]),e=window.URL.createObjectURL(e);this.gif_frame_ms=c;this.GIF&&(delete this.GIF,this.GIF=null);this.GIF=new GIF({repeat:0,workers:20,workerScript:e,quality:30,width:Math.floor(this.width),height:Math.floor(this.height)});var b=this.getEngine();this.GIF.on("finished",function(c){var d=document.createElement("a");d.download=a;d.href=URL.createObjectURL(c);c=new MouseEvent("click");d.dispatchEvent(c);document.body.removeChild(d);
delete this.GIF;this.GIF=null;b.play()})};Party.prototype.gif_add_frame=function(){this.getGLContext();var a=GLU.canvas,c=document.createElement("canvas");c.width=a.width;c.height=a.height;c=c.getContext("2d");c.drawImage(a,0,0);this.GIF.addFrame(c,{delay:30,copy:!0})};Party.prototype.gif_render=function(){this.GIF.render()};
